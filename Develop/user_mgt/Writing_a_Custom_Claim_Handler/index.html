



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Writing a Custom Claim Handler - WSO2 Identity Server Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,700|Courier+New">
        <style>body,input{font-family:"Nunito Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Courier New","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#writing-a-custom-claim-handler" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="WSO2 Identity Server Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../../images/WSO2_Software_Logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                WSO2 Identity Server Documentation
              </span>
              <span class="md-header-nav__topic">
                Writing a Custom Claim Handler
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/sherenewso2/mkdocs-base/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      View on Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../GettingStarted/Overview/" title="Getting Started" class="md-tabs__link">
          Getting Started
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Concepts/Single_Sign-On_and_Identity_Federation/" title="Concepts" class="md-tabs__link">
          Concepts
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Troubleshooting/" title="How Tos" class="md-tabs__link">
          How Tos
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../Writing_a_Custom_Password_Validator/" title="Develop" class="md-tabs__link md-tabs__link--active">
          Develop
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Admin" class="md-tabs__link">
          Admin
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Deploy" class="md-tabs__link">
          Deploy
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Troubleshooting" class="md-tabs__link">
          Troubleshooting
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="References" class="md-tabs__link">
          References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

    <!-- Site title -->
    <label class="md-nav__title md-nav__title--site" for="__drawer">
        <a href="../../.."
           title="WSO2 Identity Server Documentation" class="md-nav__button md-logo">
            
            <img src="../../../images/WSO2_Software_Logo.png" width="48" height="48" />
            
        </a>
        WSO2 Identity Server Documentation
        <label for="Versions">Ver:
            <select id="versions" onchange="window.location.href=this.value;" style="
		position: inherit;
		display: inline;
		min-width: 25%;
		/* width: 120%; */
		height: 25px;
		padding: 5px 15px 5px 5px;
		color: Black;
		border: none;
		background: transparent;
		outline: none;
		-webkit-appearance: none;
		z-index: 99;
		cursor: pointer;
		font-size: 12px;
		margin-bottom: 10px;
		border: 1px solid black;
		overflow: auto
	">
                <option value="">Versions</option>
 		<option value="https://Kanapriya.github.io/mkdocs-base-1/versions/IS/IS530/5.3.0/">5.3.0</option>
                <option value="https://Kanapriya.github.io/mkdocs-base-1/versions/IS/IS540/5.4.0/">5.4.0</option>
                <option value="https://Kanapriya.github.io/mkdocs-base-1/versions/IS/IS550/5.5.0/">5.5.0</option>
            </select>
        </label>
    </label>
    <!-- Repository containing source -->
    
    <div class="md-nav__source">
        


  


  <a href="https://github.com/sherenewso2/mkdocs-base/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      View on Github
    </div>
  </a>

    </div>
    

    <!-- Render item list -->
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../GettingStarted/Overview/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../GettingStarted/About_this_Release/" title="About this release" class="md-nav__link">
      About this release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../GettingStarted/QSG/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Concepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Single_Sign-On_and_Identity_Federation/" title="Single Sign-On and Identity Federation" class="md-nav__link">
      Single Sign-On and Identity Federation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Identity_Provisioning_and_its_Standards/" title="Identity_Provisioning and its Standards" class="md-nav__link">
      Identity_Provisioning and its Standards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Access_Control_and_Entitlement_Management/" title="Access_Control and Entitlement Management" class="md-nav__link">
      Access_Control and Entitlement Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Identity_Anti-patterns_and_the_Identity_Bus/" title="Identity Anti-patterns and the Identity Bus" class="md-nav__link">
      Identity Anti-patterns and the Identity Bus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How Tos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How Tos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Troubleshooting/" title="Troubleshooting Guide" class="md-nav__link">
      Troubleshooting Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Best Practices Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Best Practices Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../BestPracticesGuide/" title="Best Practices Guide" class="md-nav__link">
      Best Practices Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Developer_Guide/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-1" type="checkbox" id="nav-3-3-1">
    
    <label class="md-nav__link" for="nav-3-3-1">
      Testing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-1">
        Testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../WUM_Commands_Guide/" title="WUM Commands Guide" class="md-nav__link">
      WUM Commands Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-2" type="checkbox" id="nav-3-3-2">
    
    <label class="md-nav__link" for="nav-3-3-2">
      Another subpage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-2">
        Another subpage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Developer_Guide/" title="Develop" class="md-nav__link">
      Develop
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Develop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Develop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" checked>
    
    <label class="md-nav__link" for="nav-4-1">
      User Management for Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        User Management for Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Writing_a_Custom_Password_Validator/" title="Writing a Custom Password Validator" class="md-nav__link">
      Writing a Custom Password Validator
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Writing a Custom Claim Handler
      </label>
    
    <a href="./" title="Writing a Custom Claim Handler" class="md-nav__link md-nav__link--active">
      Writing a Custom Claim Handler
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-custom-claim-handler" title="Writing the custom claim handler" class="md-nav__link">
    Writing the custom claim handler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-the-custom-claim-handler" title="Deploying the custom claim handler" class="md-nav__link">
    Deploying the custom claim handler
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../User_Store_Listeners/" title="User Store Listeners" class="md-nav__link">
      User Store Listeners
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Using_the_User_Management_Errors_Event_Listener/" title="Using the User Management Errors Event Listener" class="md-nav__link">
      Using the User Management Errors Event Listener
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Carbon_Remote_User_Store_Manager/" title="Carbon Remote User Store Manager" class="md-nav__link">
      Carbon Remote User Store Manager
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Provisioning for Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Provisioning for Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../provision/Writing_an_Outbound_Provisioning_Connector/" title="Writing an Outbound Provisioning Connector" class="md-nav__link">
      Writing an Outbound Provisioning Connector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../provision/Extensible_SCIM_User_Schemas_With_WSO2_Identity_Server/" title="Extensible SCIM User Schemas With WSO2 Identity Server" class="md-nav__link">
      Extensible SCIM User Schemas With WSO2 Identity Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Identity Federation for Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Identity Federation for Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../federate/Writing_a_Custom_Federated_Authenticator/" title="Writing a Custom Federated Authenticator" class="md-nav__link">
      Writing a Custom Federated Authenticator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../federate/Writing_a_Custom_Local_Authenticator/" title="Writing a Custom Local Authenticator" class="md-nav__link">
      Writing a Custom Local Authenticator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Admin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Admin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Deploy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Deploy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
    </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-the-custom-claim-handler" title="Writing the custom claim handler" class="md-nav__link">
    Writing the custom claim handler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying-the-custom-claim-handler" title="Deploying the custom claim handler" class="md-nav__link">
    Deploying the custom claim handler
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/sherenewso2/mkdocs-base/edit/master/docs/Develop/user_mgt/Writing_a_Custom_Claim_Handler.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="writing-a-custom-claim-handler">Writing a Custom Claim Handler</h1>
<p>WSO2 Identity Server (WSO2 IS) supports SAML authentication and single
sign-on capabilities where WSO2 IS can act as the identity provider for
a relying party application (i.e., service provider). When SAML single
sign-on is used in an enterprise system, it is through the SAML response
that the relying party gets to know whether a user is authenticated or
not. At this point the relying party application is not aware of the
attributes of an authenticated user, which would be required for certain
business and authorization purposes. You can use WSO2 IS to provide
these attribute details to the relying party application, by configuring
WSO2 IS to send user claims in a SAML response using the service
provider claim configuration. For information on how to configure WSO2
IS to send user claims in a SAML response, see <a href="https://docs.wso2.com/display/IS570/Configuring+Claims+for+a+Service+Provider">Configuring Claims for a
Service
Provider</a>. </p>
<p>The claims that you can send using the service provider claim
configuration are default user claims, which can be read from the
underlying user store. However, there can be scenarios where you want to
send claims that need to be read from an external data source (i.e.,
custom claims) based on certain user attributes requested by a relying
party application. If you want to add such custom claims to a SAML
response, you need to write a custom claim handler to extend WSO2 IS.</p>
<p>Let’s look at how to add custom claims to a SAML response using a sample
scenario where you need to provide several local attributes of a user,
which are stored in user store, together with a few additional
attributes that should be read from an external data source.</p>
<ul>
<li><a href="#WritingaCustomClaimHandler-Introduction">Introduction</a></li>
<li><a href="#WritingaCustomClaimHandler-Writingthecustomclaimhandler">Writing the custom claim
    handler</a></li>
<li><a href="#WritingaCustomClaimHandler-Deployingthecustomclaimhandler">Deploying the custom claim
    handler</a></li>
</ul>
<h3 id="introduction">Introduction</h3>
<p>The SAML response that should be sent from WSO2 IS to the relying party
application is as follows:</p>
<div class="codehilite"><pre><span></span><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="o">?&gt;</span>
<span class="o">&lt;</span><span class="n">saml2p</span><span class="o">:</span><span class="n">Response</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">saml2p</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot;</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">xs</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="n">Destination</span><span class="o">=</span><span class="s">&quot;https://localhost:9444/acs&quot;</span> <span class="n">ID</span><span class="o">=</span><span class="s">&quot;faibaccbcepemkackalbbjkihlegenhhigcdjbjk&quot;</span> <span class="n">InResponseTo</span><span class="o">=</span><span class="s">&quot;kbedjkocfjdaaadgmjeipbegnclbelfffbpbophe&quot;</span> <span class="n">IssueInstant</span><span class="o">=</span><span class="s">&quot;2014-07-17T13:15:05.032Z&quot;</span> <span class="n">Version</span><span class="o">=</span><span class="s">&quot;2.0&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Issuer</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">saml2</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span> <span class="n">Format</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:entity&quot;</span><span class="o">&gt;</span><span class="n">localhost</span>
    <span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Issuer</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">ds</span><span class="o">:</span><span class="n">Signature</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">ds</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="o">&gt;</span>
        <span class="o">..........</span>
    <span class="o">&lt;/</span><span class="n">ds</span><span class="o">:</span><span class="n">Signature</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2p</span><span class="o">:</span><span class="n">Status</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2p</span><span class="o">:</span><span class="n">StatusCode</span> <span class="n">Value</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:status:Success&quot;</span><span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2p</span><span class="o">:</span><span class="n">Status</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Assertion</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">saml2</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">xs</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="n">ID</span><span class="o">=</span><span class="s">&quot;phmbbieedpcfdhcignelnepkemobepgaaipbjjdk&quot;</span> <span class="n">IssueInstant</span><span class="o">=</span><span class="s">&quot;2014-07-17T13:15:05.032Z&quot;</span> <span class="n">Version</span><span class="o">=</span><span class="s">&quot;2.0&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Issuer</span> <span class="n">Format</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:entity&quot;</span><span class="o">&gt;</span><span class="n">localhost</span><span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Issuer</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">ds</span><span class="o">:</span><span class="n">Signature</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">ds</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2000/09/xmldsig#&quot;</span><span class="o">&gt;</span>
            <span class="o">.........</span>
        <span class="o">&lt;/</span><span class="n">ds</span><span class="o">:</span><span class="n">Signature</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Subject</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">NameID</span> <span class="n">Format</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&quot;</span><span class="o">&gt;</span><span class="n">Administrator</span><span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">NameID</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">SubjectConfirmation</span> <span class="n">Method</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:cm:bearer&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">SubjectConfirmationData</span> <span class="n">InResponseTo</span><span class="o">=</span><span class="s">&quot;kbedjkocfjdaaadgmjeipbegnclbelfffbpbophe&quot;</span> <span class="n">NotOnOrAfter</span><span class="o">=</span><span class="s">&quot;2014-07-17T13:20:05.032Z&quot;</span> <span class="n">Recipient</span><span class="o">=</span><span class="s">&quot;https://localhost:9444/acs&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">SubjectConfirmation</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Subject</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Conditions</span> <span class="n">NotBefore</span><span class="o">=</span><span class="s">&quot;2014-07-17T13:15:05.032Z&quot;</span> <span class="n">NotOnOrAfter</span><span class="o">=</span><span class="s">&quot;2014-07-17T13:20:05.032Z&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AudienceRestriction</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Audience</span><span class="o">&gt;</span><span class="n">carbonServer2</span><span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Audience</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AudienceRestriction</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Conditions</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AuthnStatement</span> <span class="n">AuthnInstant</span><span class="o">=</span><span class="s">&quot;2014-07-17T13:15:05.033Z&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AuthnContext</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AuthnContextClassRef</span><span class="o">&gt;</span><span class="n">urn</span><span class="o">:</span><span class="n">oasis</span><span class="o">:</span><span class="n">names</span><span class="o">:</span><span class="n">tc</span><span class="o">:</span><span class="n">SAML</span><span class="o">:</span><span class="mf">2.0</span><span class="o">:</span><span class="n">ac</span><span class="o">:</span><span class="n">classes</span><span class="o">:</span><span class="n">Password</span><span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AuthnContextClassRef</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AuthnContext</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AuthnStatement</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeStatement</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Attribute</span> <span class="n">Name</span><span class="o">=</span><span class="s">&quot;http://wso2.org/claims/role&quot;</span> <span class="n">NameFormat</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeValue</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="n">xsi</span><span class="o">:</span><span class="n">type</span><span class="o">=</span><span class="s">&quot;xs:string&quot;</span><span class="o">&gt;</span>
                        <span class="n">Internal</span><span class="o">/</span><span class="n">carbonServer2</span><span class="o">,</span><span class="n">Internal</span><span class="o">/</span><span class="n">everyone</span>
                    <span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeValue</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Attribute</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeStatement</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Attribute</span> <span class="n">Name</span><span class="o">=</span><span class="s">&quot;http://test.org/claims/keplerNumber&quot;</span> <span class="n">NameFormat</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeValue</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="n">xsi</span><span class="o">:</span><span class="n">type</span><span class="o">=</span><span class="s">&quot;xs:string&quot;</span><span class="o">&gt;</span>
                            <span class="n">E90836W19881010</span>
                        <span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeValue</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Attribute</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">Attribute</span> <span class="n">Name</span><span class="o">=</span><span class="s">&quot;http://test.org/claims/status&quot;</span> <span class="n">NameFormat</span><span class="o">=</span><span class="s">&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeValue</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="n">xsi</span><span class="o">:</span><span class="n">type</span><span class="o">=</span><span class="s">&quot;xs:string&quot;</span><span class="o">&gt;</span>
                        <span class="n">active</span>
                    <span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeValue</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Attribute</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeStatement</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">AttributeStatement</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2</span><span class="o">:</span><span class="n">Assertion</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">saml2p</span><span class="o">:</span><span class="n">Response</span><span class="o">&gt;</span>
</pre></div>

<p>This response has one local attribute named <code class="codehilite"><span class="k">role</span></code>, and two external
attributes as follows:</p>
<ul>
<li><code class="codehilite">http://test.org/claims/keplerNumber</code></li>
<li><code class="codehilite">http://test.org/claims/status</code></li>
</ul>
<p>The external attributes can be read from either a database, or a file,
or via any other mechanism depending on your requirement.<code class="codehilite"></code></p>
<p>To retrieve the external attributes in this response, you need to write
a custom claim handler.</p>
<h3 id="writing-the-custom-claim-handler">Writing the custom claim handler</h3>
<p>Follow the steps below:</p>
<ul>
<li>
<p>Implement the custom logic to retrieve external claims. When you
    implement the custom logic, keep the following in mind:</p>
<ul>
<li>The custom implementation should either implement the
    <code class="codehilite">org.wso2.carbon.identity.application.authentication.framework.handler.claims.ClaimHandler</code>
    interface, or should extend the default implementation of the
    <code class="codehilite">org.wso2.carbon.identity.application.authentication.framework.handler.claims.impl.DefaultClaimHandler</code>
    interface.</li>
<li>The map that returns at the
    <code class="codehilite">public Map&lt;String, String&gt; handleClaimMappings</code> method should
    contain all the attributes that you want to add to the SAML
    response.</li>
</ul>
<p>Following is a sample custom claim handler that implements the
<code class="codehilite">org.wso2.carbon.identity.application.authentication.framework.handler.claims.ClaimHandler</code>
interface:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomClaimHandler</span> <span class="kd">implements</span> <span class="n">ClaimHandler</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Log</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">CustomClaimHandler</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="n">CustomClaimHandler</span> <span class="n">instance</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">connectionURL</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">jdbcDriver</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>


    <span class="kd">public</span> <span class="kd">static</span> <span class="n">CustomClaimHandler</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">CustomClaimHandler</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomClaimHandler</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">handleClaimMappings</span><span class="o">(</span><span class="n">StepConfig</span> <span class="n">stepConfig</span><span class="o">,</span>
                                                   <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">remoteAttributes</span><span class="o">,</span>
                                                   <span class="kt">boolean</span> <span class="n">isFederatedClaims</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">FrameworkException</span> <span class="o">{</span>

        <span class="n">String</span> <span class="n">authenticatedUser</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">stepConfig</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//calling from StepBasedSequenceHandler</span>
            <span class="n">authenticatedUser</span> <span class="o">=</span> <span class="n">stepConfig</span><span class="o">.</span><span class="na">getAuthenticatedUser</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">//calling from RequestPathBasedSequenceHandler</span>
            <span class="n">authenticatedUser</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getSequenceConfig</span><span class="o">().</span><span class="na">getAuthenticatedUser</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="n">handleLocalClaims</span><span class="o">(</span><span class="n">authenticatedUser</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
        <span class="n">claims</span><span class="o">.</span><span class="na">putAll</span><span class="o">(</span><span class="n">handleExternalClaims</span><span class="o">(</span><span class="n">authenticatedUser</span><span class="o">));</span>

        <span class="k">return</span> <span class="n">claims</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="cm">/**</span>
<span class="cm">     * @param context</span>
<span class="cm">     * @return</span>
<span class="cm">     * @throws FrameworkException</span>
<span class="cm">     */</span>
    <span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">handleLocalClaims</span><span class="o">(</span><span class="n">String</span> <span class="n">authenticatedUser</span><span class="o">,</span>
                                                    <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">FrameworkException</span> <span class="o">{</span>
    <span class="o">....</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">getFilteredAttributes</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">allAttributes</span><span class="o">,</span>
                                                      <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">requestedClaimMappings</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isStandardDialect</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">....</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getDialectUri</span><span class="o">(</span><span class="n">String</span> <span class="n">clientType</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">claimMappingDefined</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">....</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Added method to retrieve claims from external sources. The results will be merged to the local claims when</span>
<span class="cm">     * returning the final claim list to be added to the SAML response that is sent back to the SP.</span>
<span class="cm">     *</span>
<span class="cm">     * @param authenticatedUser : The user for whom we require claim values</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">handleExternalClaims</span><span class="o">(</span><span class="n">String</span> <span class="n">authenticatedUser</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">FrameworkException</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">externalClaims</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
        <span class="n">externalClaims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;http://test.org/claims/keplerNumber&quot;</span><span class="o">,</span><span class="s">&quot;E90836W19881010&quot;</span><span class="o">);</span>
        <span class="n">externalClaims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;http://test.org/claims/status&quot;</span><span class="o">,</span><span class="s">&quot;active&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">externalClaims</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>After you write the custom claim handler, and register the class as
an OSGI bundle, you can deploy the OSGi bundle in WSO2 IS.</p>
</li>
</ul>
<h3 id="deploying-the-custom-claim-handler">Deploying the custom claim handler</h3>
<p>Follow the steps below to deploy the custom claim handler that you
implemented:</p>
<ol>
<li>Add the compiled OSGi bundle to the
    <code class="codehilite">IS_HOME/repository/components/dropins</code> directory.</li>
<li>
<p>Edit the
    <code class="codehilite">&lt;IS_HOME&gt;/repository/conf/identity/application-authentication.xml</code>
    file, and add the following under the <code class="codehilite">&lt;Extensions&gt;</code> element.</p>
<div class="codehilite"><pre><span></span><span class="o">&lt;</span><span class="n">ClaimHandler</span><span class="o">&gt;</span><span class="n">com</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">sample</span><span class="o">.</span><span class="na">claim</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">CustomClaimHandler</span><span class="o">&lt;/</span><span class="n">ClaimHandler</span><span class="o">&gt;</span>
</pre></div>

<p>This allows you to use the new custom claim implementation with WSO2
IS.</p>
</li>
</ol>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Writing_a_Custom_Password_Validator/" title="Writing a Custom Password Validator" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Writing a Custom Password Validator
              </span>
            </div>
          </a>
        
        
          <a href="../User_Store_Listeners/" title="User Store Listeners" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                User Store Listeners
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>