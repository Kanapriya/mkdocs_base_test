



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Writing a Custom Federated Authenticator - WSO2 Identity Server Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.572ca0f0.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,400i,700|Courier+New">
        <style>body,input{font-family:"Nunito Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Courier New","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../extra.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#writing-a-custom-federated-authenticator" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="WSO2 Identity Server Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../../images/WSO2_Software_Logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                WSO2 Identity Server Documentation
              </span>
              <span class="md-header-nav__topic">
                Writing a Custom Federated Authenticator
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/sherenewso2/mkdocs-base/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      View on Github
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../GettingStarted/Overview/" title="Getting Started" class="md-tabs__link">
          Getting Started
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Concepts/Single_Sign-On_and_Identity_Federation/" title="Concepts" class="md-tabs__link">
          Concepts
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Troubleshooting/" title="How Tos" class="md-tabs__link">
          How Tos
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../user_mgt/Writing_a_Custom_Password_Validator/" title="Develop" class="md-tabs__link">
          Develop
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Admin" class="md-tabs__link">
          Admin
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Deploy" class="md-tabs__link">
          Deploy
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Troubleshooting" class="md-tabs__link">
          Troubleshooting
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="References" class="md-tabs__link">
          References
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../Getting_Started/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

    <!-- Site title -->
    <label class="md-nav__title md-nav__title--site" for="__drawer">
        <a href="../../.."
           title="WSO2 Identity Server Documentation" class="md-nav__button md-logo">
            
            <img src="../../../images/WSO2_Software_Logo.png" width="48" height="48" />
            
        </a>
        WSO2 Identity Server Documentation
        <label for="Versions">Ver:
            <select id="versions" onchange="window.location.href=this.value;" style="
		position: inherit;
		display: inline;
		min-width: 25%;
		/* width: 120%; */
		height: 25px;
		padding: 5px 15px 5px 5px;
		color: Black;
		border: none;
		background: transparent;
		outline: none;
		-webkit-appearance: none;
		z-index: 99;
		cursor: pointer;
		font-size: 12px;
		margin-bottom: 10px;
		border: 1px solid black;
		overflow: auto
	">
                <option value="" selected="selected">Versions</option>
 		<option value="https://Kanapriya.github.io/mkdocs-base-1/versions/IS/IS530/5.3.0/">5.3.0</option>
                <option value="https://Kanapriya.github.io/mkdocs-base-1/versions/IS/IS540/5.4.0/">5.4.0</option>
                <option value="https://Kanapriya.github.io/mkdocs-base-1/versions/IS/IS550/5.5.0/">5.5.0</option>
            </select>
        </label>
    </label>
    <!-- Repository containing source -->
    
    <div class="md-nav__source">
        


  


  <a href="https://github.com/sherenewso2/mkdocs-base/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      View on Github
    </div>
  </a>

    </div>
    

    <!-- Render item list -->
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../GettingStarted/Overview/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../GettingStarted/About_this_Release/" title="About this release" class="md-nav__link">
      About this release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../GettingStarted/QSG/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Concepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Concepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Single_Sign-On_and_Identity_Federation/" title="Single Sign-On and Identity Federation" class="md-nav__link">
      Single Sign-On and Identity Federation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Identity_Provisioning_and_its_Standards/" title="Identity_Provisioning and its Standards" class="md-nav__link">
      Identity_Provisioning and its Standards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Access_Control_and_Entitlement_Management/" title="Access_Control and Entitlement Management" class="md-nav__link">
      Access_Control and Entitlement Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Concepts/Identity_Anti-patterns_and_the_Identity_Bus/" title="Identity Anti-patterns and the Identity Bus" class="md-nav__link">
      Identity Anti-patterns and the Identity Bus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      How Tos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        How Tos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Troubleshooting/" title="Troubleshooting Guide" class="md-nav__link">
      Troubleshooting Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Best Practices Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Best Practices Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../BestPracticesGuide/" title="Best Practices Guide" class="md-nav__link">
      Best Practices Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Developer_Guide/" title="Testing" class="md-nav__link">
      Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Developer Guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Developer Guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-1" type="checkbox" id="nav-3-3-1">
    
    <label class="md-nav__link" for="nav-3-3-1">
      Testing
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-1">
        Testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../WUM_Commands_Guide/" title="WUM Commands Guide" class="md-nav__link">
      WUM Commands Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3-2" type="checkbox" id="nav-3-3-2">
    
    <label class="md-nav__link" for="nav-3-3-2">
      Another subpage
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-3-2">
        Another subpage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Developer_Guide/" title="Develop" class="md-nav__link">
      Develop
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Develop
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Develop
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      User Management for Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        User Management for Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_mgt/Writing_a_Custom_Password_Validator/" title="Writing a Custom Password Validator" class="md-nav__link">
      Writing a Custom Password Validator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_mgt/Writing_a_Custom_Claim_Handler/" title="Writing a Custom Claim Handler" class="md-nav__link">
      Writing a Custom Claim Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_mgt/User_Store_Listeners/" title="User Store Listeners" class="md-nav__link">
      User Store Listeners
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_mgt/Using_the_User_Management_Errors_Event_Listener/" title="Using the User Management Errors Event Listener" class="md-nav__link">
      Using the User Management Errors Event Listener
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_mgt/Carbon_Remote_User_Store_Manager/" title="Carbon Remote User Store Manager" class="md-nav__link">
      Carbon Remote User Store Manager
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Provisioning for Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Provisioning for Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../provision/Writing_an_Outbound_Provisioning_Connector/" title="Writing an Outbound Provisioning Connector" class="md-nav__link">
      Writing an Outbound Provisioning Connector
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../provision/Extensible_SCIM_User_Schemas_With_WSO2_Identity_Server/" title="Extensible SCIM User Schemas With WSO2 Identity Server" class="md-nav__link">
      Extensible SCIM User Schemas With WSO2 Identity Server
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3" checked>
    
    <label class="md-nav__link" for="nav-4-3">
      Identity Federation for Developers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Identity Federation for Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Writing a Custom Federated Authenticator
      </label>
    
    <a href="./" title="Writing a Custom Federated Authenticator" class="md-nav__link md-nav__link--active">
      Writing a Custom Federated Authenticator
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#authenticator-api" title="Authenticator API" class="md-nav__link">
    Authenticator API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-custom-authenticator-for-twitter" title="Writing a custom authenticator for Twitter" class="md-nav__link">
    Writing a custom authenticator for Twitter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-authenticator-for-facebook" title="Custom authenticator for Facebook" class="md-nav__link">
    Custom authenticator for Facebook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-authenticator-for-google" title="Custom authenticator for Google" class="md-nav__link">
    Custom authenticator for Google
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Writing_a_Custom_Local_Authenticator/" title="Writing a Custom Local Authenticator" class="md-nav__link">
      Writing a Custom Local Authenticator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Admin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Admin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Deploy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Deploy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Troubleshooting
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Troubleshooting
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      References
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        References
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Getting_Started/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../Using_WSO2_In-Place_Updates/" title="Using WSO2 In-Place Updates" class="md-nav__link">
      Using WSO2 In-Place Updates
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
    </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#authenticator-api" title="Authenticator API" class="md-nav__link">
    Authenticator API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-a-custom-authenticator-for-twitter" title="Writing a custom authenticator for Twitter" class="md-nav__link">
    Writing a custom authenticator for Twitter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-authenticator-for-facebook" title="Custom authenticator for Facebook" class="md-nav__link">
    Custom authenticator for Facebook
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-authenticator-for-google" title="Custom authenticator for Google" class="md-nav__link">
    Custom authenticator for Google
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/sherenewso2/mkdocs-base/edit/master/docs/Develop/federate/Writing_a_Custom_Federated_Authenticator.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="writing-a-custom-federated-authenticator">Writing a Custom Federated Authenticator</h1>
<p>It is possible to use the extension points available in the WSO2
Identity Server to create custom federated authenticators. See the
following topics to create different custom authenticators.</p>
<ul>
<li><a href="#WritingaCustomFederatedAuthenticator-AuthenticatorAPI">Authenticator
    API </a></li>
<li><a href="#WritingaCustomFederatedAuthenticator-WritingacustomauthenticatorforTwitter">Writing a custom authenticator for
    Twitter</a></li>
<li><a href="#WritingaCustomFederatedAuthenticator-CustomauthenticatorforFacebook">Custom authenticator for
    Facebook</a></li>
<li><a href="#WritingaCustomFederatedAuthenticator-CustomauthenticatorforGoogle">Custom authenticator for
    Google</a></li>
</ul>
<h3 id="authenticator-api">Authenticator API</h3>
<p>The following is the API used to implement a custom federated
authenticator.</p>
<div class="codehilite"><pre><span></span><span class="cm">/*</span>
<span class="cm">*  Copyright (c) 2005-2013, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span>
<span class="cm">*</span>
<span class="cm">*  WSO2 Inc. licenses this file to you under the Apache License,</span>
<span class="cm">*  Version 2.0 (the &quot;License&quot;); you may not use this file except</span>
<span class="cm">*  in compliance with the License.</span>
<span class="cm">*  You may obtain a copy of the License at</span>
<span class="cm">*</span>
<span class="cm">*    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="cm">*</span>
<span class="cm">* Unless required by applicable law or agreed to in writing,</span>
<span class="cm">* software distributed under the License is distributed on an</span>
<span class="cm">* &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm">* KIND, either express or implied.  See the License for the</span>
<span class="cm">* specific language governing permissions and limitations</span>
<span class="cm">* under the License.</span>
<span class="cm">*/</span>

<span class="kn">package</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.context.AuthenticationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.exception.AuthenticationFailedException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.exception.LogoutFailedException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.common.model.Property</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * API of the Application Authenticators.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ApplicationAuthenticator</span> <span class="kd">extends</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Check whether the authentication or logout request can be handled by the</span>
<span class="cm">     * authenticator</span>
<span class="cm">     * </span>
<span class="cm">     * @param request</span>
<span class="cm">     * @return boolean</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Process the authentication or logout request.</span>
<span class="cm">     * </span>
<span class="cm">     * @param request</span>
<span class="cm">     * @param response</span>
<span class="cm">     * @param context</span>
<span class="cm">     * @return the status of the flow</span>
<span class="cm">     * @throws AuthenticationFailedException</span>
<span class="cm">     * @throws LogoutFailedException</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">AuthenticatorFlowStatus</span> <span class="nf">process</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
            <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">AuthenticationFailedException</span><span class="o">,</span> <span class="n">LogoutFailedException</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the Context identifier sent with the request. This identifier is used</span>
<span class="cm">     * to retrieve the state of the authentication/logout flow</span>
<span class="cm">     * </span>
<span class="cm">     * @param request</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContextIdentifier</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the name of the Authenticator</span>
<span class="cm">     * @return name</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFriendlyName</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * Get the claim dialect URI if this authenticator receives claims in a standard dialect</span>
<span class="cm">     * and needs to be mapped to the Carbon dialect http://wso2.org/claims</span>
<span class="cm">     * @return boolean</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getClaimDialectURI</span><span class="o">();</span>

    <span class="cm">/**</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="nf">getConfigurationProperties</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>

<p>This API can be used to configure a custom authenticator. As an example,
a Twitter authenticator is configured using the above API.</p>
<h3 id="writing-a-custom-authenticator-for-twitter">Writing a custom authenticator for Twitter</h3>
<p>The WSO2 Identity Server comes with several built in authenticators like
Facebook, Google, OpenID, and SAML. This topic provides instructions on
how to authenticate users via Twitter using the SAML configurations
available in the Identity Server.</p>
<p><strong>Related links</strong></p>
<ul>
<li>See <a href="https://dev.twitter.com/web/sign-in/desktop-browser">here</a> for
    information on browser sign in flow. This information is useful when
    working with websites and applications that are able to open or
    embed a web browser.</li>
<li>See <a href="https://dev.twitter.com/web/sign-in/implementing">here</a> for
    information on implementing the sign in functionality using Twitter.</li>
<li>If you are doing this using Java, there is a library you can use
    called <a href="index">twitter4j</a>. See the link for code samples on signing
    in with Twitter.</li>
</ul>
<p>The following code block represents the structure of an
authenticator <strong>pom.xml</strong>. Authenticators are basically OSGi (Open
Service Gateway initiative) bundles, which are units of modularization
that are comprised of Java classes and other resources that provide
functions to end users. The <strong>pom.xml</strong> includes the dependencies for
the project. Other than the twitter4j dependency, other dependencies are
mandatory.</p>
<p><img alt="" src="images/icons/grey_arrow_down.png" />{.expand-control-image}Click here
to expand and view the code block</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>org.emojotFoundation<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>authenticator-twitter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>bundle<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.wso2.carbon<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>org.wso2.carbon.logging<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.wso2.carbon<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>org.wso2.carbon.identity.application.authentication.framework<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.2.2<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.wso2.carbon<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>org.wso2.carbon.ui<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.amber.wso2<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>amber<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>0.22.1358727.wso2v4<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.wso2.carbon<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>org.wso2.carbon.identity.application.common<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>4.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.twitter4j<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>twitter4j-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>[4.0,)<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;repositories&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>wso2-nexus<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>WSO2 Internal Repository<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://maven.wso2.org/nexus/content/groups/wso2-public/<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
                <span class="nt">&lt;updatePolicy&gt;</span>daily<span class="nt">&lt;/updatePolicy&gt;</span>
                <span class="nt">&lt;checksumPolicy&gt;</span>ignore<span class="nt">&lt;/checksumPolicy&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
        <span class="nt">&lt;repository&gt;</span>
            <span class="nt">&lt;id&gt;</span>twitter4j.org<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;name&gt;</span>twitter4j.org Repository<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://twitter4j.org/maven2<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;releases&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/releases&gt;</span>
            <span class="nt">&lt;snapshots&gt;</span>
                <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
            <span class="nt">&lt;/snapshots&gt;</span>
        <span class="nt">&lt;/repository&gt;</span>
    <span class="nt">&lt;/repositories&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-scr-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>1.7.4<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;executions&gt;</span>
                    <span class="nt">&lt;execution&gt;</span>
                        <span class="nt">&lt;id&gt;</span>generate-scr-scrdescriptor<span class="nt">&lt;/id&gt;</span>
                        <span class="nt">&lt;goals&gt;</span>
                            <span class="nt">&lt;goal&gt;</span>scr<span class="nt">&lt;/goal&gt;</span>
                        <span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;/execution&gt;</span>
                <span class="nt">&lt;/executions&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;instructions&gt;</span>
                        <span class="nt">&lt;Bundle-SymbolicName&gt;</span>${project.artifactId}<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
                        <span class="nt">&lt;Bundle-Name&gt;</span>${project.artifactId}<span class="nt">&lt;/Bundle-Name&gt;</span>
                        <span class="nt">&lt;Private-Package&gt;</span>org.emojotFoundation.authenticator.twitter.internal<span class="nt">&lt;/Private-Package&gt;</span>
                        <span class="nt">&lt;Import-Package&gt;</span>org.twitter4j.*;
                            version=&quot;[4.0,)&quot;,
                            org.apache.axis2.*;
                            version=&quot;[1.6.1.wso2v1, 1.7.0)&quot;,
                            org.apache.axiom.*;
                            version=&quot;[1.2.11.wso2v2, 1.3.0)&quot;,
                            org.wso2.carbon.ui.*,
                            org.apache.commons.logging.*; version=&quot;1.0.4&quot;,
                            org.osgi.framework,
                            org.wso2.carbon.identity.application.authentication.framework.*,
                            javax.servlet;version=&quot;[2.6.0,3.0.0)&quot;,
                            javax.servlet.http;version=&quot;[2.6.0,3.0.0)&quot;,
                            *;resolution:=optional
                        <span class="nt">&lt;/Import-Package&gt;</span>
                        <span class="nt">&lt;Export-Package&gt;</span>!org.emojotFoundation.authenticator.twitter.internal,
                            org.emojotFoundation.authenticator.twitter.*
                        <span class="nt">&lt;/Export-Package&gt;</span>
                        <span class="nt">&lt;DynamicImport-Package&gt;</span>*<span class="nt">&lt;/DynamicImport-Package&gt;</span>
                    <span class="nt">&lt;/instructions&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>

<p>Since the project is an OSGi bundle, you must add this class to define
the bundle activate method and deactivate method.</p>
<p><img alt="" src="images/icons/grey_arrow_down.png" />{.expand-control-image}Click here
to expand and view the class used to define the bundle activate method
and deactivate method</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">org.emojotFoundation.authenticator.twitter.internal</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Hashtable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.ComponentContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.ApplicationAuthenticator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.emojotFoundation.authenticator.twitter.TwitterAuthenticator</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * @scr.component name=&quot;authenticator.twitter&quot; immediate=&quot;true&quot;</span>
<span class="cm"> */</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TwitterAuthenticatorServiceComponent</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Log</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">TwitterAuthenticatorServiceComponent</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">activate</span><span class="o">(</span><span class="n">ComponentContext</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">TwitterAuthenticator</span> <span class="n">twitterAuthenticator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TwitterAuthenticator</span><span class="o">();</span>
            <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span>
            <span class="n">ctxt</span><span class="o">.</span><span class="na">getBundleContext</span><span class="o">().</span><span class="na">registerService</span><span class="o">(</span><span class="n">ApplicationAuthenticator</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">twitterAuthenticator</span><span class="o">,</span> <span class="n">props</span><span class="o">);</span> 

            <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;----Twitter Authenticator bundle is activated----&quot;</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">fatal</span><span class="o">(</span><span class="s">&quot;----Error while activating Twitter authenticator----&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="o">(</span><span class="n">ComponentContext</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;----Twitter Authenticator bundle is deactivated----&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>After adding this to your project, you are in a position to write your
authenticator. Authenticators are defined by extending
the <code class="codehilite">AbstractApplicationAuthenticator</code> class and implementing
the <code class="codehilite">FederatedApplicationAuthenticator</code> interface. The important methods
in the <code class="codehilite">AbstractApplicationAuthenticator</code> class and
the <code class="codehilite">FederatedApplicationAuthenticator</code> interface are listed as follows.</p>
<ul>
<li>public String getName()</li>
<li>public String getFriendlyName()</li>
<li>public String getContextIdentifier(HttpServletRequest request) -
    Returns a unique identifier that will map the authentication request
    and the response. The value returned by the invocation of
    authentication request and the response should be the same.</li>
<li>public boolean canHandle(HttpServletRequest request) - Specifies
    whether this authenticator can handle the authentication response.</li>
<li>protected void initiateAuthenticationRequest(HttpServletRequest
    request,HttpServletResponse response, AuthenticationContext context)</li>
<li>protected void processAuthenticationResponse(HttpServletRequest
    request,HttpServletResponse response, AuthenticationContext context)</li>
</ul>
<p>Use the following steps to write the Twitter authenticator.</p>
<ol>
<li>
<p>Implement the <code class="codehilite">canHandle()</code> method using the above methods. When
    Twitter sends the OAuth response, it sends the
    parameters <code class="codehilite">oauth_token</code> and <code class="codehilite">oauth_verifier</code> in the request. This
    is a notification to identify that this response can be handled by
    the authenticator.</p>
<p><img alt="" src="images/icons/grey_arrow_down.png" />{.expand-control-image}Click
here to expand and view a sample canHandle() method</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;oauth_token&quot;</span><span class="o">)!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;oauth_verifier&quot;</span><span class="o">)!=</span><span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>

</li>
<li>
<p>For each authentication request that comes into the Identity Server,
    there is unique value that comes along as a parameter. That
    parameter is the <code class="codehilite">sessionDataKey</code>. Store this in the Twitter
    authentication redirection session to facilitate the requirement
    where <code class="codehilite">getContextIdentifier</code> gives the same value for authentication
    request and its response.</p>
<p><img alt="" src="images/icons/grey_arrow_down.png" />{.expand-control-image}Click
here to expand and view getContextIdentifier()</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">getContextIdentifier</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;contextIdentifier&quot;</span><span class="o">)==</span><span class="kc">null</span><span class="o">){</span> 
            <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;contextIdentifier&quot;</span><span class="o">,</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;sessionDataKey&quot;</span><span class="o">));</span>
            <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;sessionDataKey&quot;</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span><span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;contextIdentifier&quot;</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</pre></div>

</li>
<li>
<p>Next, implement the <code class="codehilite">initiateAuthenticationRequest</code> method and
    the <code class="codehilite">processAuthenticationResponse</code> method as follows.</p>
<p><img alt="" src="images/icons/grey_arrow_down.png" />{.expand-control-image}Click
here to expand and view the initiateAuthenticationRequest method and
processAuthenticationResponse method</p>
<div class="codehilite"><pre><span></span><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initiateAuthenticationRequest</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationFailedException</span> <span class="o">{</span>       

        <span class="n">String</span> <span class="n">apiKey</span><span class="o">=</span> <span class="n">resourceBundle</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;API_Key&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">apiSecret</span><span class="o">=</span> <span class="n">resourceBundle</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;API_Secret&quot;</span><span class="o">);</span>

        <span class="n">Twitter</span> <span class="n">twitter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TwitterFactory</span><span class="o">().</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="n">twitter</span><span class="o">.</span><span class="na">setOAuthConsumer</span><span class="o">(</span><span class="n">apiKey</span><span class="o">,</span> <span class="n">apiSecret</span><span class="o">);</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">callbackURL</span> <span class="o">=</span> <span class="n">resourceBundle</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;Call_Back_URL&quot;</span><span class="o">);</span>
            <span class="n">RequestToken</span> <span class="n">requestToken</span> <span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="na">getOAuthRequestToken</span><span class="o">(</span><span class="n">callbackURL</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;requestToken&quot;</span><span class="o">,</span><span class="n">requestToken</span><span class="o">);</span>
            <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;twitter&quot;</span><span class="o">,</span><span class="n">twitter</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">requestToken</span><span class="o">.</span><span class="na">getAuthenticationURL</span><span class="o">());</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">TwitterException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Exception while sending to the Twitter login page.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">AuthenticationFailedException</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Exception while sending to the Twitter login page.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">AuthenticationFailedException</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">processAuthenticationResponse</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">AuthenticationFailedException</span> <span class="o">{</span>
        <span class="n">Twitter</span> <span class="n">twitter</span> <span class="o">=</span> <span class="o">(</span><span class="n">Twitter</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;twitter&quot;</span><span class="o">);</span>
        <span class="n">RequestToken</span> <span class="n">requestToken</span> <span class="o">=</span> <span class="o">(</span><span class="n">RequestToken</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;requestToken&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">verifier</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;oauth_verifier&quot;</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">AccessToken</span> <span class="n">token</span><span class="o">=</span><span class="n">twitter</span><span class="o">.</span><span class="na">getOAuthAccessToken</span><span class="o">(</span><span class="n">requestToken</span><span class="o">,</span> <span class="n">verifier</span><span class="o">);</span>
            <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&quot;requestToken&quot;</span><span class="o">);</span>
            <span class="n">User</span> <span class="n">user</span><span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="na">verifyCredentials</span><span class="o">();</span>
            <span class="n">buildClaims</span><span class="o">(</span><span class="n">user</span><span class="o">,</span><span class="n">context</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">TwitterException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Exception while obtaining OAuth token form Twitter&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">AuthenticationFailedException</span><span class="o">(</span><span class="s">&quot;Exception while obtaining OAuth token form Twitter&quot;</span><span class="o">,</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildClaims</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">,</span> <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>

            <span class="n">context</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="na">getId</span><span class="o">()));</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">ClaimMapping</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">ClaimMapping</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>
            <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ClaimMapping</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span><span class="kc">false</span><span class="o">),</span> <span class="n">user</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ClaimMapping</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s">&quot;screen_name&quot;</span><span class="o">,</span> <span class="s">&quot;screen_name&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span><span class="kc">false</span><span class="o">),</span> <span class="n">user</span><span class="o">.</span><span class="na">getScreenName</span><span class="o">());</span>
            <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ClaimMapping</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="s">&quot;url&quot;</span><span class="o">,</span> <span class="s">&quot;url&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span><span class="kc">false</span><span class="o">),</span> <span class="n">user</span><span class="o">.</span><span class="na">getURL</span><span class="o">());</span>

            <span class="n">context</span><span class="o">.</span><span class="na">setSubjectAttributes</span><span class="o">(</span><span class="n">claims</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>

</li>
<li>
<p>The <code class="codehilite">buildClaims</code> method saves the retrieved user attributes to the
    authenticated context in the Identity Server. That is needed to map
    the claims to the built in claims of IS.</p>
</li>
<li>After implementing these methods you can build your bundle. After
    building it you have to put that into
    the <code class="codehilite">&lt;IS_HOME&gt;/repository/components/dropins</code> directory.</li>
<li><a href="https://docs.wso2.com/display/IS570/Running+the+Product">Restart the Identity
    Server</a> to
    use the Twitter authenticator in IS.</li>
</ol>
<h3 id="custom-authenticator-for-facebook">Custom authenticator for Facebook</h3>
<p>This section includes the code used to write the custom authenticator
for Facebook.</p>
<ol>
<li>
<p>Download the source code from
    <a href="https://svn.wso2.org/repos/wso2/people/isura/org.wso2.carbon.identity.application.authenticator.social/">here</a>
    using the following command on your terminal. </p>
<div class="codehilite"><pre><span></span><span class="n">$</span> <span class="n">svn</span> <span class="n">checkout</span> <span class="n">https</span><span class="o">:</span><span class="c1">//svn.wso2.org/repos/wso2/people/isura/org.wso2.carbon.identity.application.authenticator.social/ </span>
</pre></div>

</li>
<li>
<p>Navigate to the folder you just downloaded, which contains the
    <code class="codehilite">pom.xml</code> file and build the source code by running the following
    command on your terminal. </p>
<div class="codehilite"><pre><span></span><span class="n">$</span> <span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>

</li>
<li>
<p>Copy
    the <code class="codehilite">org.wso2.carbon.identity.application.authenticator.social.facebook2-5.0.0.jar</code>
    file found inside the <strong>target</strong> folder and paste it in
    the<code class="codehilite">&lt;IS_HOME&gt;/repository/components/dropins</code>folder. </p>
</li>
</ol>
<p>The source code is as follows. </p>
<div class="codehilite"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2014, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * WSO2 Inc. licenses this file to you under the Apache License,</span>
<span class="cm"> * Version 2.0 (the &quot;License&quot;); you may not use this file except</span>
<span class="cm"> * in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> * http://www.apache.org/licenses/LICENSE­2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied. See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>
<span class="kn">package</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.social.facebook2</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.StringUtils</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.oltu.oauth2.client.request.OAuthClientRequest</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.oltu.oauth2.client.response.OAuthAuthzResponse</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.oltu.oauth2.common.exception.OAuthProblemException</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.oltu.oauth2.common.exception.OAuthSystemException</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.oltu.oauth2.common.utils.JSONUtils</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.AbstractApplicationAuthenticator</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.FederatedApplicationAuthenticator</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.context.AuthenticationContext</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.exception.ApplicationAuthenticatorException</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.exception.AuthenticationFailedException</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.model.AuthenticatedUser</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.util.FrameworkConstants</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.util.FrameworkUtils</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.common.model.ClaimMapping</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.common.model.Property</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.common.util.IdentityApplicationConstants</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.base.IdentityConstants</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.core.util.IdentityUtil</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.core.util.IdentityIOStreamUtils</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.net.MalformedURLException</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.net.URL</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.net.URLConnection</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.Charset</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">class</span> <span class="nc">FacebookCustomAuthenticator</span> <span class="kd">extends</span> <span class="n">AbstractApplicationAuthenticator</span> <span class="kd">implements</span>
<span class="n">FederatedApplicationAuthenticator</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Log</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">FacebookCustomAuthenticator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span><span class="err">;</span>
 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="err">­</span><span class="mi">1465329490183756028</span> <span class="n">L</span><span class="err">;</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="n">tokenEndpoint</span><span class="err">;</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="n">oAuthEndpoint</span><span class="err">;</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="n">userInfoEndpoint</span><span class="err">;</span>
 <span class="cm">/**</span>
<span class="cm">  * initiate tokenEndpoint</span>
<span class="cm">  */</span>
 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initTokenEndpoint</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span> <span class="o">=</span>
    <span class="n">getAuthenticatorConfig</span><span class="o">().</span><span class="na">getParameterMap</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span>
     <span class="o">.</span><span class="na">FB_TOKEN_URL</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span> <span class="o">=</span> <span class="n">IdentityApplicationConstants</span><span class="o">.</span><span class="na">FB_TOKEN_URL</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * initiate authorization server endpoint</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initOAuthEndpoint</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span> <span class="o">=</span>
    <span class="n">getAuthenticatorConfig</span><span class="o">().</span><span class="na">getParameterMap</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span>
     <span class="o">.</span><span class="na">FB_AUTHZ_URL</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span> <span class="o">=</span> <span class="n">IdentityApplicationConstants</span><span class="o">.</span><span class="na">FB_AUTHZ_URL</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * initiate userInfoEndpoint</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initUserInfoEndPoint</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">userInfoEndpoint</span> <span class="o">=</span>
    <span class="n">getAuthenticatorConfig</span><span class="o">().</span><span class="na">getParameterMap</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span>
     <span class="o">.</span><span class="na">FB_USER_INFO_URL</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">userInfoEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">userInfoEndpoint</span> <span class="o">=</span> <span class="n">IdentityApplicationConstants</span><span class="o">.</span><span class="na">FB_USER_INFO_URL</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * get the tokenEndpoint.</span>
<span class="cm">   * @return tokenEndpoint</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getTokenEndpoint</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">initTokenEndpoint</span><span class="o">()</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * get the oAuthEndpoint.</span>
<span class="cm">   * @return oAuthEndpoint</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getAuthorizationServerEndpoint</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">initOAuthEndpoint</span><span class="o">()</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * get the userInfoEndpoint.</span>
<span class="cm">   * @return userInfoEndpoint</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getUserInfoEndpoint</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">userInfoEndpoint</span><span class="o">))</span> <span class="o">{</span>
   <span class="n">initUserInfoEndPoint</span><span class="o">()</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">userInfoEndpoint</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">log</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&quot;Inside FacebookAuthenticator.canHandle()&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">OAUTH2_GRANT_TYPE_CODE</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
   <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">OAUTH2_PARAM_STATE</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
   <span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">FACEBOOK_LOGIN_TYPE</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">getLoginType</span><span class="o">(</span><span class="n">request</span><span class="o">)))</span> <span class="o">{</span>
   <span class="k">return</span> <span class="kc">true</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">initiateAuthenticationRequest</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
  <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">AuthenticationFailedException</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">Map</span> <span class="n">authenticatorProperties</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getAuthenticatorProperties</span><span class="o">()</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">clientId</span> <span class="o">=</span> <span class="n">authenticatorProperties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">CLIENT_ID</span><span class="o">)</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">authorizationEP</span> <span class="o">=</span> <span class="n">getAuthorizationServerEndpoint</span><span class="o">()</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">scope</span> <span class="o">=</span> <span class="n">authenticatorProperties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">SCOPE</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">scope</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">scope</span> <span class="o">=</span> <span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">EMAIL</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="n">String</span> <span class="n">callbackUrl</span> <span class="o">=</span> <span class="n">IdentityUtil</span><span class="o">.</span><span class="na">getServerURL</span><span class="o">(</span><span class="n">FrameworkConstants</span><span class="o">.</span><span class="na">COMMONAUTH</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">state</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getContextIdentifier</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span>
    <span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">FACEBOOK_LOGIN_TYPE</span><span class="err">;</span>
   <span class="n">OAuthClientRequest</span> <span class="n">authzRequest</span> <span class="o">=</span>
    <span class="n">OAuthClientRequest</span><span class="o">.</span><span class="na">authorizationLocation</span><span class="o">(</span><span class="n">authorizationEP</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setClientId</span><span class="o">(</span><span class="n">clientId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setRedirectURI</span><span class="o">(</span><span class="n">callbackUrl</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setResponseType</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">OAUTH2_GRANT_TYPE_CODE</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setScope</span><span class="o">(</span><span class="n">scope</span><span class="o">).</span><span class="na">setState</span><span class="o">(</span><span class="n">state</span><span class="o">)</span>
    <span class="o">.</span><span class="na">buildQueryMessage</span><span class="o">()</span><span class="err">;</span>
   <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">authzRequest</span><span class="o">.</span><span class="na">getLocationUri</span><span class="o">())</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Exception while sending to the login page.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">AuthenticationFailedException</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">OAuthSystemException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Exception while building authorization code request.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">AuthenticationFailedException</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="k">return</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">processAuthenticationResponse</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
  <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
  <span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">AuthenticationFailedException</span> <span class="o">{</span>
  <span class="n">log</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&quot;Inside FacebookAuthenticator.authenticate()&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">Map</span> <span class="n">authenticatorProperties</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getAuthenticatorProperties</span><span class="o">()</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">clientId</span> <span class="o">=</span> <span class="n">authenticatorProperties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">CLIENT_ID</span><span class="o">)</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">clientSecret</span> <span class="o">=</span>
    <span class="n">authenticatorProperties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">CLIENT_SECRET</span><span class="o">)</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">userInfoFields</span> <span class="o">=</span>
    <span class="n">authenticatorProperties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">USER_INFO_FIELDS</span><span class="o">)</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">tokenEndPoint</span> <span class="o">=</span> <span class="n">getTokenEndpoint</span><span class="o">()</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">fbauthUserInfoUrl</span> <span class="o">=</span> <span class="n">getUserInfoEndpoint</span><span class="o">()</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">callbackUrl</span> <span class="o">=</span> <span class="n">IdentityUtil</span><span class="o">.</span><span class="na">getServerURL</span><span class="o">(</span><span class="n">FrameworkConstants</span><span class="o">.</span><span class="na">COMMONAUTH</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">getAuthorizationCode</span><span class="o">(</span><span class="n">request</span><span class="o">)</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="n">getToken</span><span class="o">(</span><span class="n">tokenEndPoint</span><span class="o">,</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">,</span> <span class="n">callbackUrl</span><span class="o">,</span> <span class="n">code</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">userInfoFields</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getExternalIdP</span><span class="o">().</span><span class="na">getIdentityProvider</span><span class="o">().</span><span class="na">getClaimConfig</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getExternalIdP</span><span class="o">().</span><span class="na">getIdentityProvider</span><span class="o">().</span><span class="na">getClaimConfig</span><span class="o">().</span><span class="na">getUserClaimURI</span><span class="o">()))</span> <span class="o">{</span>
     <span class="n">String</span> <span class="n">userClaimUri</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getExternalIdP</span><span class="o">().</span><span class="na">getIdentityProvider</span><span class="o">().</span><span class="na">getClaimConfig</span><span class="o">()</span>
      <span class="o">.</span><span class="na">getUserClaimURI</span><span class="o">()</span><span class="err">;</span>
     <span class="k">if</span> <span class="o">(!</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">userInfoFields</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)).</span><span class="na">contains</span><span class="o">(</span><span class="n">userClaimUri</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">userInfoFields</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">userClaimUri</span><span class="o">)</span><span class="err">;</span>
     <span class="o">}</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
     <span class="k">if</span> <span class="o">(!</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">userInfoFields</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)).</span><span class="na">contains</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span>
       <span class="o">.</span><span class="na">DEFAULT_USER_IDENTIFIER</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">userInfoFields</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">DEFAULT_USER_IDENTIFIER</span><span class="o">)</span><span class="err">;</span>
     <span class="o">}</span>
    <span class="o">}</span>
   <span class="o">}</span>
   <span class="n">Map</span> <span class="n">userInfoJson</span> <span class="o">=</span> <span class="n">getUserInfoJson</span><span class="o">(</span><span class="n">fbauthUserInfoUrl</span><span class="o">,</span> <span class="n">userInfoFields</span><span class="o">,</span> <span class="n">token</span><span class="o">)</span><span class="err">;</span>
   <span class="n">buildClaims</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">userInfoJson</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ApplicationAuthenticatorException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;Failed to process Facebook Connect response.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">AuthenticationFailedException</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getAuthorizationCode</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ApplicationAuthenticatorException</span> <span class="o">{</span>
  <span class="n">OAuthAuthzResponse</span> <span class="n">authzResponse</span><span class="err">;</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">authzResponse</span> <span class="o">=</span> <span class="n">OAuthAuthzResponse</span><span class="o">.</span><span class="na">oauthCodeAuthzResponse</span><span class="o">(</span><span class="n">request</span><span class="o">)</span><span class="err">;</span>
   <span class="k">return</span> <span class="n">authzResponse</span><span class="o">.</span><span class="na">getCode</span><span class="o">()</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">OAuthProblemException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span><span class="s">&quot;Exception while reading authorization code.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getToken</span><span class="o">(</span><span class="n">String</span> <span class="n">tokenEndPoint</span><span class="o">,</span> <span class="n">String</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">String</span> <span class="n">clientSecret</span><span class="o">,</span>
  <span class="n">String</span> <span class="n">callbackurl</span><span class="o">,</span> <span class="n">String</span> <span class="n">code</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ApplicationAuthenticatorException</span> <span class="o">{</span>
  <span class="n">OAuthClientRequest</span> <span class="n">tokenRequest</span> <span class="o">=</span> <span class="kc">null</span><span class="err">;</span>
  <span class="n">String</span> <span class="n">token</span> <span class="o">=</span> <span class="kc">null</span><span class="err">;</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">tokenRequest</span> <span class="o">=</span>
    <span class="n">buidTokenRequest</span><span class="o">(</span><span class="n">tokenEndPoint</span><span class="o">,</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">clientSecret</span><span class="o">,</span> <span class="n">callbackurl</span><span class="o">,</span>
     <span class="n">code</span><span class="o">)</span><span class="err">;</span>
   <span class="n">token</span> <span class="o">=</span> <span class="n">sendRequest</span><span class="o">(</span><span class="n">tokenRequest</span><span class="o">.</span><span class="na">getLocationUri</span><span class="o">())</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">token</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">&quot;{&quot;</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span><span class="s">&quot;Received access token is invalid.&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;URL : &quot;</span> <span class="o">+</span> <span class="n">tokenRequest</span><span class="o">.</span><span class="na">getLocationUri</span><span class="o">())</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span>
    <span class="s">&quot;MalformedURLException while sending access token request.&quot;</span><span class="o">,</span>
    <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span><span class="s">&quot;IOException while sending access token request.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">token</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="n">OAuthClientRequest</span> <span class="nf">buidTokenRequest</span><span class="o">(</span>
  <span class="n">String</span> <span class="n">tokenEndPoint</span><span class="o">,</span> <span class="n">String</span> <span class="n">clientId</span><span class="o">,</span> <span class="n">String</span> <span class="n">clientSecret</span><span class="o">,</span> <span class="n">String</span> <span class="n">callbackurl</span><span class="o">,</span> <span class="n">String</span> <span class="n">code</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">ApplicationAuthenticatorException</span> <span class="o">{</span>
  <span class="n">OAuthClientRequest</span> <span class="n">tokenRequest</span> <span class="o">=</span> <span class="kc">null</span><span class="err">;</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">tokenRequest</span> <span class="o">=</span>
    <span class="n">OAuthClientRequest</span><span class="o">.</span><span class="na">tokenLocation</span><span class="o">(</span><span class="n">tokenEndPoint</span><span class="o">).</span><span class="na">setClientId</span><span class="o">(</span><span class="n">clientId</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setClientSecret</span><span class="o">(</span><span class="n">clientSecret</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setRedirectURI</span><span class="o">(</span><span class="n">callbackurl</span><span class="o">).</span><span class="na">setCode</span><span class="o">(</span><span class="n">code</span><span class="o">)</span>
    <span class="o">.</span><span class="na">buildQueryMessage</span><span class="o">()</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">OAuthSystemException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span><span class="s">&quot;Exception while building access token request.&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">tokenRequest</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getUserInfoString</span><span class="o">(</span><span class="n">String</span> <span class="n">fbAuthUserInfoUrl</span><span class="o">,</span> <span class="n">String</span> <span class="n">userInfoFields</span><span class="o">,</span> <span class="n">String</span> <span class="n">token</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">ApplicationAuthenticatorException</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">userInfoString</span><span class="err">;</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">userInfoFields</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">userInfoString</span> <span class="o">=</span> <span class="n">sendRequest</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s?%s&quot;</span><span class="o">,</span> <span class="n">fbAuthUserInfoUrl</span><span class="o">,</span> <span class="n">token</span><span class="o">))</span><span class="err">;</span>
   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">userInfoString</span> <span class="o">=</span> <span class="n">sendRequest</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&quot;%s?fields=%s&amp;%s&quot;</span><span class="o">,</span> <span class="n">fbAuthUserInfoUrl</span><span class="o">,</span> <span class="n">userInfoFields</span><span class="o">,</span>
     <span class="n">token</span><span class="o">))</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">MalformedURLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;URL : &quot;</span> <span class="o">+</span> <span class="n">fbAuthUserInfoUrl</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span>
    <span class="s">&quot;MalformedURLException while sending user information request.&quot;</span><span class="o">,</span>
    <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span>
    <span class="s">&quot;IOException while sending sending user information request.&quot;</span><span class="o">,</span>
    <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">userInfoString</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setSubject</span><span class="o">(</span><span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">Map</span> <span class="n">jsonObject</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">ApplicationAuthenticatorException</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">authenticatedUserId</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span>
  <span class="n">jsonObject</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">DEFAULT_USER_IDENTIFIER</span><span class="o">)</span><span class="err">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">authenticatedUserId</span><span class="o">))</span> <span class="o">{</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span><span class="s">&quot;Authenticated user identifier is empty&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="n">AuthenticatedUser</span> <span class="n">authenticatedUser</span> <span class="o">=</span>
   <span class="n">AuthenticatedUser</span><span class="o">.</span><span class="na">createFederateAuthenticatedUserFromSubjectIdentifier</span><span class="o">(</span><span class="n">authenticatedUserId</span><span class="o">)</span><span class="err">;</span>
  <span class="n">context</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">authenticatedUser</span><span class="o">)</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="n">Map</span> <span class="nf">getUserInfoJson</span><span class="o">(</span><span class="n">String</span> <span class="n">fbAuthUserInfoUrl</span><span class="o">,</span> <span class="n">String</span> <span class="n">userInfoFields</span><span class="o">,</span> <span class="n">String</span> <span class="n">token</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">ApplicationAuthenticatorException</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">userInfoString</span> <span class="o">=</span> <span class="n">getUserInfoString</span><span class="o">(</span><span class="n">fbAuthUserInfoUrl</span><span class="o">,</span> <span class="n">userInfoFields</span><span class="o">,</span> <span class="n">token</span><span class="o">)</span><span class="err">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">()</span> <span class="o">&amp;&amp;</span> <span class="n">IdentityUtil</span><span class="o">.</span><span class="na">isTokenLoggable</span><span class="o">(</span><span class="n">IdentityConstants</span><span class="o">.</span><span class="na">IdentityTokens</span><span class="o">.</span><span class="na">USER_ID_TOKEN</span><span class="o">))</span> <span class="o">{</span>
   <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;UserInfoString : &quot;</span> <span class="o">+</span> <span class="n">userInfoString</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="n">Map</span> <span class="n">jsonObject</span> <span class="o">=</span> <span class="n">JSONUtils</span><span class="o">.</span><span class="na">parseJSON</span><span class="o">(</span><span class="n">userInfoString</span><span class="o">)</span><span class="err">;</span>
  <span class="k">return</span> <span class="n">jsonObject</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildClaims</span><span class="o">(</span><span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">Map</span> <span class="n">jsonObject</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">ApplicationAuthenticatorException</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">jsonObject</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">Map</span> <span class="n">claims</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">()</span><span class="err">;</span>
   <span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span> <span class="n">entry</span><span class="o">:</span> <span class="n">jsonObject</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ClaimMapping</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="kc">null</span><span class="o">,</span>
     <span class="kc">false</span><span class="o">),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">toString</span><span class="o">())</span><span class="err">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">()</span> <span class="o">&amp;&amp;</span>
     <span class="n">IdentityUtil</span><span class="o">.</span><span class="na">isTokenLoggable</span><span class="o">(</span><span class="n">IdentityConstants</span><span class="o">.</span><span class="na">IdentityTokens</span><span class="o">.</span><span class="na">USER_CLAIMS</span><span class="o">))</span> <span class="o">{</span>
     <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Adding claim mapping : &quot;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &lt;&gt; &quot;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; : &quot;</span> <span class="o">+</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">())</span><span class="err">;</span>
    <span class="o">}</span>
   <span class="o">}</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getExternalIdP</span><span class="o">().</span><span class="na">getIdentityProvider</span><span class="o">().</span><span class="na">getClaimConfig</span><span class="o">().</span><span class="na">getUserClaimURI</span><span class="o">()))</span> <span class="o">{</span>
    <span class="n">context</span><span class="o">.</span><span class="na">getExternalIdP</span><span class="o">().</span><span class="na">getIdentityProvider</span><span class="o">().</span><span class="na">getClaimConfig</span><span class="o">().</span><span class="na">setUserClaimURI</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">EMAIL</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="n">String</span> <span class="n">subjectFromClaims</span> <span class="o">=</span> <span class="n">FrameworkUtils</span><span class="o">.</span><span class="na">getFederatedSubjectFromClaims</span><span class="o">(</span>
    <span class="n">context</span><span class="o">.</span><span class="na">getExternalIdP</span><span class="o">().</span><span class="na">getIdentityProvider</span><span class="o">(),</span> <span class="n">claims</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">subjectFromClaims</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">subjectFromClaims</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">AuthenticatedUser</span> <span class="n">authenticatedUser</span> <span class="o">=</span>
     <span class="n">AuthenticatedUser</span><span class="o">.</span><span class="na">createFederateAuthenticatedUserFromSubjectIdentifier</span><span class="o">(</span><span class="n">subjectFromClaims</span><span class="o">)</span><span class="err">;</span>
    <span class="n">context</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">authenticatedUser</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">setSubject</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">jsonObject</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="n">context</span><span class="o">.</span><span class="na">getSubject</span><span class="o">().</span><span class="na">setUserAttributes</span><span class="o">(</span><span class="n">claims</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">log</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Decoded json object is null&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">throw</span> <span class="k">new</span> <span class="n">ApplicationAuthenticatorException</span><span class="o">(</span><span class="s">&quot;Decoded json object is null&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">getContextIdentifier</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">log</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">&quot;Inside FacebookAuthenticator.getContextIdentifier()&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">String</span> <span class="n">state</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">OAUTH2_PARAM_STATE</span><span class="o">)</span><span class="err">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)[</span><span class="mi">0</span><span class="o">]</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
   <span class="k">return</span> <span class="kc">null</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">sendRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
  <span class="n">BufferedReader</span> <span class="n">in</span> <span class="o">=</span> <span class="kc">null</span><span class="err">;</span>
  <span class="n">StringBuilder</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">()</span><span class="err">;</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">URLConnection</span> <span class="n">urlConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="n">url</span><span class="o">).</span><span class="na">openConnection</span><span class="o">()</span><span class="err">;</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">urlConnection</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span>
    <span class="n">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;utf­8&quot;</span><span class="o">)))</span><span class="err">;</span>
   <span class="n">String</span> <span class="n">inputLine</span> <span class="o">=</span> <span class="n">in</span> <span class="o">.</span><span class="na">readLine</span><span class="o">()</span><span class="err">;</span>
   <span class="k">while</span> <span class="o">(</span><span class="n">inputLine</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">b</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">inputLine</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">)</span><span class="err">;</span>
    <span class="n">inputLine</span> <span class="o">=</span> <span class="n">in</span> <span class="o">.</span><span class="na">readLine</span><span class="o">()</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
   <span class="n">IdentityIOStreamUtils</span><span class="o">.</span><span class="na">closeReader</span><span class="o">(</span> <span class="n">in</span> <span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">b</span><span class="o">.</span><span class="na">toString</span><span class="o">()</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getLoginType</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">state</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">OAUTH2_PARAM_STATE</span><span class="o">)</span><span class="err">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">state</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;,&quot;</span><span class="o">)[</span><span class="mi">1</span><span class="o">]</span><span class="err">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
   <span class="k">return</span> <span class="kc">null</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFriendlyName</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="s">&quot;Custom­Facebook&quot;</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">AUTHENTICATOR_NAME</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">List</span> <span class="nf">getConfigurationProperties</span><span class="o">()</span> <span class="o">{</span>
  <span class="n">List</span> <span class="n">configProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">()</span><span class="err">;</span>
  <span class="n">Property</span> <span class="n">clientId</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
  <span class="n">clientId</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">CLIENT_ID</span><span class="o">)</span><span class="err">;</span>
  <span class="n">clientId</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;Client Id&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">clientId</span><span class="o">.</span><span class="na">setRequired</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="err">;</span>
  <span class="n">clientId</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Enter Facebook client identifier value&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">clientId</span><span class="o">)</span><span class="err">;</span>
  <span class="n">Property</span> <span class="n">clientSecret</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
  <span class="n">clientSecret</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">CLIENT_SECRET</span><span class="o">)</span><span class="err">;</span>
  <span class="n">clientSecret</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;Client Secret&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">clientSecret</span><span class="o">.</span><span class="na">setRequired</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="err">;</span>
  <span class="n">clientSecret</span><span class="o">.</span><span class="na">setConfidential</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="err">;</span>
  <span class="n">clientSecret</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Enter Facebook client secret value&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">clientSecret</span><span class="o">)</span><span class="err">;</span>
  <span class="n">Property</span> <span class="n">scope</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
  <span class="n">scope</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">SCOPE</span><span class="o">)</span><span class="err">;</span>
  <span class="n">scope</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;Scope&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">scope</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Enter Facebook scopes&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">scope</span><span class="o">.</span><span class="na">setDefaultValue</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">scope</span><span class="o">.</span><span class="na">setRequired</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span><span class="err">;</span>
  <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">scope</span><span class="o">)</span><span class="err">;</span>
  <span class="n">Property</span> <span class="n">userIdentifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
  <span class="n">userIdentifier</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorConstants</span><span class="o">.</span><span class="na">USER_INFO_FIELDS</span><span class="o">)</span><span class="err">;</span>
  <span class="n">userIdentifier</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;User Identifier Field&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">userIdentifier</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Enter Facebook user identifier field&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">userIdentifier</span><span class="o">.</span><span class="na">setDefaultValue</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="n">userIdentifier</span><span class="o">.</span><span class="na">setRequired</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span><span class="err">;</span>
  <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">userIdentifier</span><span class="o">)</span><span class="err">;</span>
  <span class="k">return</span> <span class="n">configProperties</span><span class="err">;</span>
 <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2014, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * WSO2 Inc. licenses this file to you under the Apache License,</span>
<span class="cm"> * Version 2.0 (the &quot;License&quot;); you may not use this file except</span>
<span class="cm"> * in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> * http://www.apache.org/licenses/LICENSE­2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied. See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>
<span class="kn">package</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.social.facebook2</span><span class="err">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FacebookCustomAuthenticatorConstants</span> <span class="o">{</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">AUTHENTICATOR_NAME</span> <span class="o">=</span> <span class="s">&quot;FacebookAuthenticator­Custom&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FACEBOOK_LOGIN_TYPE</span> <span class="o">=</span> <span class="s">&quot;facebook&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">OAUTH2_GRANT_TYPE_CODE</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">OAUTH2_PARAM_STATE</span> <span class="o">=</span> <span class="s">&quot;state&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EMAIL</span> <span class="o">=</span> <span class="s">&quot;email&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SCOPE</span> <span class="o">=</span> <span class="s">&quot;Scope&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">USER_INFO_FIELDS</span> <span class="o">=</span> <span class="s">&quot;UserInfoFields&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_USER_IDENTIFIER</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CLIENT_ID</span> <span class="o">=</span> <span class="s">&quot;ClientId&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CLIENT_SECRET</span> <span class="o">=</span> <span class="s">&quot;ClientSecret&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FB_AUTHZ_URL</span> <span class="o">=</span> <span class="s">&quot;AuthnEndpoint&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FB_TOKEN_URL</span> <span class="o">=</span> <span class="s">&quot;AuthTokenEndpoint&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FB_USER_INFO_URL</span> <span class="o">=</span> <span class="s">&quot;UserInfoEndpoint&quot;</span><span class="err">;</span>
 <span class="kd">private</span> <span class="nf">FacebookCustomAuthenticatorConstants</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>
<span class="cm">/*</span>
<span class="cm"> * Copyright (c) WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * WSO2 Inc. licenses this file to you under the Apache License,</span>
<span class="cm"> * Version 2.0 (the &quot;License&quot;); you may not use this file except</span>
<span class="cm"> * in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> * http://www.apache.org/licenses/LICENSE­2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied. See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>
<span class="kn">package</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.social.internal</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.ComponentContext</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.ApplicationAuthenticator</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.social.facebook2.FacebookCustomAuthenticator</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.util.Hashtable</span><span class="err">;</span>
 <span class="cm">/**</span>
<span class="cm">  * @scr.component name=&quot;identity.application.authenticator.facebook.component&quot;</span>
<span class="cm">  * immediate=&quot;true&quot;</span>
<span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FacebookCustomAuthenticatorServiceComponent</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Log</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">FacebookCustomAuthenticatorServiceComponent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span><span class="err">;</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">activate</span><span class="o">(</span><span class="n">ComponentContext</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">FacebookCustomAuthenticator</span> <span class="n">facebookAuthenticator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FacebookCustomAuthenticator</span><span class="o">()</span><span class="err">;</span>
   <span class="n">Hashtable</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">()</span><span class="err">;</span>
   <span class="n">ctxt</span><span class="o">.</span><span class="na">getBundleContext</span><span class="o">().</span><span class="na">registerService</span><span class="o">(</span><span class="n">ApplicationAuthenticator</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
    <span class="n">facebookAuthenticator</span><span class="o">,</span> <span class="n">props</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">LOGGER</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Facebook Custome Authenticator bundle is activated&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">LOGGER</span><span class="o">.</span><span class="na">fatal</span><span class="o">(</span><span class="s">&quot; Error while activating Facebook authenticator &quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="o">(</span><span class="n">ComponentContext</span> <span class="n">ctxt</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">LOGGER</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
   <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Facebook Custom Authenticator bundle is deactivated&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h3 id="custom-authenticator-for-google">Custom authenticator for Google</h3>
<p>This section includes the code used to write the custom authenticator
for Google.</p>
<ol>
<li>
<p>Download the source code
    from <a href="https://svn.wso2.org/repos/wso2/people/thanuja/org.wso2.carbon.identity.application.authenticator.social/">here</a> using
    the following command on your terminal. </p>
<div class="codehilite"><pre><span></span><span class="n">$</span> <span class="n">svn</span> <span class="n">checkout</span> <span class="n">https</span><span class="o">:</span><span class="c1">//svn.wso2.org/repos/wso2/people/thanuja/org.wso2.carbon.identity.application.authenticator.social/</span>
</pre></div>

</li>
<li>
<p>Navigate to the folder you just downloaded, which contains
    the <code class="codehilite">pom.xml</code> file and build the source code by running the
    following command on your terminal. </p>
<div class="codehilite"><pre><span></span><span class="n">$</span> <span class="n">mvn</span> <span class="n">clean</span> <span class="n">install</span>
</pre></div>

</li>
<li>
<p>Copy
    the <code class="codehilite">org.wso2.carbon.identity.application.authenticator.custom.google­5.0.0.jar</code>file
    found inside the <strong>target</strong> folder and paste it in
    the<code class="codehilite">&lt;IS_HOME&gt;/repository/components/dropins</code>folder. </p>
</li>
</ol>
<p>The source code is as follows. </p>
<div class="codehilite"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2015, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * WSO2 Inc. licenses this file to you under the Apache License,</span>
<span class="cm"> * Version 2.0 (the &quot;License&quot;); you may not use this file except</span>
<span class="cm"> * in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> * http://www.apache.org/licenses/LICENSE­2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied. See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>
<span class="kn">package</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.custom.google</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang.StringUtils</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.oltu.oauth2.client.response.OAuthClientResponse</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.context.AuthenticationContext</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.oidc.OIDCAuthenticatorConstants</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.oidc.OpenIDConnectAuthenticator</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.common.model.Property</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.common.util.IdentityApplicationConstants</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="err">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoogleCustomOAuth2Authenticator</span> <span class="kd">extends</span> <span class="n">OpenIDConnectAuthenticator</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="err">­</span><span class="mi">4154255583070524011</span> <span class="n">L</span><span class="err">;</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="n">tokenEndpoint</span><span class="err">;</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="n">oAuthEndpoint</span><span class="err">;</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="n">userInfoURL</span><span class="err">;</span>
 <span class="cm">/**</span>
<span class="cm">  * initiate tokenEndpoint</span>
<span class="cm">  */</span>
 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initTokenEndpoint</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span> <span class="o">=</span>
    <span class="n">getAuthenticatorConfig</span><span class="o">().</span><span class="na">getParameterMap</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">GoogleCustomOAuth2AuthenticationConstant</span>
     <span class="o">.</span><span class="na">GOOGLE_TOKEN_ENDPOINT</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span> <span class="o">=</span> <span class="n">IdentityApplicationConstants</span><span class="o">.</span><span class="na">GOOGLE_TOKEN_URL</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * initiate authorization server endpoint</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initOAuthEndpoint</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span> <span class="o">=</span>
    <span class="n">getAuthenticatorConfig</span><span class="o">().</span><span class="na">getParameterMap</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="n">GoogleCustomOAuth2AuthenticationConstant</span>
     <span class="o">.</span><span class="na">GOOGLE_AUTHZ_ENDPOINT</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span> <span class="o">=</span> <span class="n">IdentityApplicationConstants</span><span class="o">.</span><span class="na">GOOGLE_OAUTH_URL</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Initialize the Yahoo user info url.</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="kt">void</span> <span class="nf">initUserInfoURL</span><span class="o">()</span> <span class="o">{</span>
   <span class="n">userInfoURL</span> <span class="o">=</span> <span class="n">getAuthenticatorConfig</span><span class="o">()</span>
    <span class="o">.</span><span class="na">getParameterMap</span><span class="o">()</span>
    <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">GoogleCustomOAuth2AuthenticationConstant</span><span class="o">.</span><span class="na">GOOGLE_USERINFO_ENDPOINT</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">userInfoURL</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">userInfoURL</span> <span class="o">=</span> <span class="n">IdentityApplicationConstants</span><span class="o">.</span><span class="na">GOOGLE_USERINFO_URL</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Get the user info endpoint url.</span>
<span class="cm">   * @return User info endpoint url.</span>
<span class="cm">   */</span>
 <span class="kd">private</span> <span class="n">String</span> <span class="nf">getUserInfoURL</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">userInfoURL</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">initUserInfoURL</span><span class="o">()</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="n">userInfoURL</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Get Authorization Server Endpoint</span>
<span class="cm">   *</span>
<span class="cm">   * @param authenticatorProperties this is not used currently in the method</span>
<span class="cm">   * @return oAuthEndpoint</span>
<span class="cm">   */</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getAuthorizationServerEndpoint</span><span class="o">(</span><span class="n">Map</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span> <span class="o">&gt;</span> <span class="n">authenticatorProperties</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">initOAuthEndpoint</span><span class="o">()</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">oAuthEndpoint</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Get Token Endpoint</span>
<span class="cm">   *</span>
<span class="cm">   * @param authenticatorProperties this is not used currently in the method</span>
<span class="cm">   * @return tokenEndpoint</span>
<span class="cm">   */</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getTokenEndpoint</span><span class="o">(</span><span class="n">Map</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span> <span class="o">&gt;</span> <span class="n">authenticatorProperties</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">initTokenEndpoint</span><span class="o">()</span><span class="err">;</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">tokenEndpoint</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Get Scope</span>
<span class="cm">   *</span>
<span class="cm">   * @param scope</span>
<span class="cm">   * @param authenticatorProperties</span>
<span class="cm">   * @return</span>
<span class="cm">   */</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getScope</span><span class="o">(</span><span class="n">String</span> <span class="n">scope</span><span class="o">,</span>
  <span class="n">Map</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span> <span class="o">&gt;</span> <span class="n">authenticatorProperties</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">GoogleCustomOAuth2AuthenticationConstant</span><span class="o">.</span><span class="na">GOOGLE_SCOPE</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getAuthenticateUser</span><span class="o">(</span><span class="n">AuthenticationContext</span> <span class="n">context</span><span class="o">,</span> <span class="n">Map</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">Object</span> <span class="o">&gt;</span> <span class="n">jsonObject</span><span class="o">,</span>
   <span class="n">OAuthClientResponse</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">jsonObject</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">OIDCAuthenticatorConstants</span><span class="o">.</span><span class="na">Claim</span><span class="o">.</span><span class="na">EMAIL</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">jsonObject</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;sub&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">jsonObject</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">OIDCAuthenticatorConstants</span><span class="o">.</span><span class="na">Claim</span><span class="o">.</span><span class="na">EMAIL</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Get google user info endpoint.</span>
<span class="cm">   * @param token OAuth client response.</span>
<span class="cm">   * @return User info endpoint.</span>
<span class="cm">   */</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getUserInfoEndpoint</span><span class="o">(</span><span class="n">OAuthClientResponse</span> <span class="n">token</span><span class="o">,</span> <span class="n">Map</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span> <span class="o">&gt;</span> <span class="n">authenticatorProperties</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">getUserInfoURL</span><span class="o">()</span><span class="err">;</span>
 <span class="o">}</span>
 <span class="nd">@Override</span>
 <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getQueryString</span><span class="o">(</span><span class="n">Map</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span> <span class="o">&gt;</span> <span class="n">authenticatorProperties</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span>
   <span class="n">authenticatorProperties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">GoogleCustomOAuth2AuthenticationConstant</span><span class="o">.</span><span class="na">ADDITIONAL_QUERY_PARAMS</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Get Configuration Properties</span>
<span class="cm">   *</span>
<span class="cm">   * @return</span>
<span class="cm">   */</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">List</span> <span class="o">&lt;</span> <span class="n">Property</span> <span class="o">&gt;</span> <span class="n">getConfigurationProperties</span><span class="o">()</span> <span class="o">{</span>
   <span class="n">List</span> <span class="o">&lt;</span> <span class="n">Property</span> <span class="o">&gt;</span> <span class="n">configProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span> <span class="o">&lt;</span> <span class="n">Property</span> <span class="o">&gt;</span> <span class="o">()</span><span class="err">;</span>
   <span class="n">Property</span> <span class="n">clientId</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
   <span class="n">clientId</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">OIDCAuthenticatorConstants</span><span class="o">.</span><span class="na">CLIENT_ID</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientId</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;Client Id&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientId</span><span class="o">.</span><span class="na">setRequired</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientId</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Enter Google IDP client identifier value&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientId</span><span class="o">.</span><span class="na">setDisplayOrder</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span><span class="err">;</span>
   <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">clientId</span><span class="o">)</span><span class="err">;</span>
   <span class="n">Property</span> <span class="n">clientSecret</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
   <span class="n">clientSecret</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">OIDCAuthenticatorConstants</span><span class="o">.</span><span class="na">CLIENT_SECRET</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientSecret</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;Client Secret&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientSecret</span><span class="o">.</span><span class="na">setRequired</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientSecret</span><span class="o">.</span><span class="na">setConfidential</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientSecret</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Enter Google IDP client secret value&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">clientSecret</span><span class="o">.</span><span class="na">setDisplayOrder</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span><span class="err">;</span>
   <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">clientSecret</span><span class="o">)</span><span class="err">;</span>
   <span class="n">Property</span> <span class="n">callbackUrl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
   <span class="n">callbackUrl</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;Callback Url&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">callbackUrl</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">IdentityApplicationConstants</span><span class="o">.</span><span class="na">OAuth2</span><span class="o">.</span><span class="na">CALLBACK_URL</span><span class="o">)</span><span class="err">;</span>
   <span class="n">callbackUrl</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Enter value corresponding to callback url.&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">callbackUrl</span><span class="o">.</span><span class="na">setDisplayOrder</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span><span class="err">;</span>
   <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">callbackUrl</span><span class="o">)</span><span class="err">;</span>
   <span class="n">Property</span> <span class="n">scope</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Property</span><span class="o">()</span><span class="err">;</span>
   <span class="n">scope</span><span class="o">.</span><span class="na">setDisplayName</span><span class="o">(</span><span class="s">&quot;Additional Query Parameters&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">scope</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;AdditionalQueryParameters&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">scope</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&quot;scope=openid email profile&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">scope</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">&quot;Additional query parameters. e.g: paramName1=value1&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="n">scope</span><span class="o">.</span><span class="na">setDisplayOrder</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span><span class="err">;</span>
   <span class="n">configProperties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">scope</span><span class="o">)</span><span class="err">;</span>
   <span class="k">return</span> <span class="n">configProperties</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * Get Friendly Name</span>
<span class="cm">   *</span>
<span class="cm">   * @return</span>
<span class="cm">   */</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFriendlyName</span><span class="o">()</span> <span class="o">{</span>
   <span class="k">return</span> <span class="n">GoogleCustomOAuth2AuthenticationConstant</span><span class="o">.</span><span class="na">GOOGLE_CONNECTOR_FRIENDLY_NAME</span><span class="err">;</span>
  <span class="o">}</span>
  <span class="cm">/**</span>
<span class="cm">   * GetName</span>
<span class="cm">   *</span>
<span class="cm">   * @return</span>
<span class="cm">   */</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">GoogleCustomOAuth2AuthenticationConstant</span><span class="o">.</span><span class="na">GOOGLE_CONNECTOR_NAME</span><span class="err">;</span>
 <span class="o">}</span>
<span class="o">}</span>
<span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2015, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * WSO2 Inc. licenses this file to you under the Apache License,</span>
<span class="cm"> * Version 2.0 (the &quot;License&quot;); you may not use this file except</span>
<span class="cm"> * in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> * http://www.apache.org/licenses/LICENSE­2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied. See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>
<span class="kn">package</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.custom.google</span><span class="err">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoogleCustomOAuth2AuthenticationConstant</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="nf">GoogleCustomOAuth2AuthenticationConstant</span><span class="o">()</span> <span class="o">{}</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GOOGLE_AUTHZ_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;GoogleAuthzEndpoint&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GOOGLE_TOKEN_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;GoogleTokenEndpoint&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GOOGLE_USERINFO_ENDPOINT</span> <span class="o">=</span> <span class="s">&quot;GoogleUserInfoEndpoint&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GOOGLE_CONNECTOR_FRIENDLY_NAME</span> <span class="o">=</span> <span class="s">&quot;Custom Google Authenticator&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GOOGLE_CONNECTOR_NAME</span> <span class="o">=</span> <span class="s">&quot;CustomGoogleOAUth2OpenIDAuthenticator&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">GOOGLE_SCOPE</span> <span class="o">=</span> <span class="s">&quot;openid email profile&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CALLBACK_URL</span> <span class="o">=</span> <span class="s">&quot;Google­callback­url&quot;</span><span class="err">;</span>
 <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ADDITIONAL_QUERY_PARAMS</span> <span class="o">=</span> <span class="s">&quot;AdditionalQueryParameters&quot;</span><span class="err">;</span>
<span class="o">}</span>
<span class="cm">/*</span>
<span class="cm"> * Copyright (c) WSO2 Inc. (http://www.wso2.org) All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * WSO2 Inc. licenses this file to you under the Apache License,</span>
<span class="cm"> * Version 2.0 (the &quot;License&quot;); you may not use this file except</span>
<span class="cm"> * in compliance with the License.</span>
<span class="cm"> * You may obtain a copy of the License at</span>
<span class="cm"> *</span>
<span class="cm"> * http://www.apache.org/licenses/LICENSE­2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Unless required by applicable law or agreed to in writing,</span>
<span class="cm"> * software distributed under the License is distributed on an</span>
<span class="cm"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="cm"> * KIND, either express or implied. See the License for the</span>
<span class="cm"> * specific language governing permissions and limitations</span>
<span class="cm"> * under the License.</span>
<span class="cm"> */</span>
<span class="kn">package</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.custom.internal</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.Log</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.logging.LogFactory</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.service.component.ComponentContext</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authentication.framework.ApplicationAuthenticator</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">org.wso2.carbon.identity.application.authenticator.custom.google.GoogleCustomOAuth2Authenticator</span><span class="err">;</span>
<span class="kn">import</span> <span class="nn">java.util.Hashtable</span><span class="err">;</span>
 <span class="cm">/**</span>
<span class="cm">  * @scr.component name=&quot;identity.application.authenticator.custom.google.component&quot; immediate=&quot;true&quot;</span>
<span class="cm">  */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoogleCustomAuthenticatorServiceComponent</span> <span class="o">{</span>
 <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Log</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LogFactory</span><span class="o">.</span><span class="na">getLog</span><span class="o">(</span><span class="n">GoogleCustomAuthenticatorServiceComponent</span><span class="o">.</span><span class="na">class</span><span class="o">)</span><span class="err">;</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">activate</span><span class="o">(</span><span class="n">ComponentContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">{</span>
   <span class="n">GoogleCustomOAuth2Authenticator</span> <span class="n">googleAuthenticator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GoogleCustomOAuth2Authenticator</span><span class="o">()</span><span class="err">;</span>
   <span class="n">Hashtable</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span> <span class="o">&gt;</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span> <span class="o">&lt;</span> <span class="n">String</span><span class="o">,</span> <span class="n">String</span> <span class="o">&gt;</span> <span class="o">()</span><span class="err">;</span>
   <span class="n">context</span><span class="o">.</span><span class="na">getBundleContext</span><span class="o">().</span><span class="na">registerService</span><span class="o">(</span><span class="n">ApplicationAuthenticator</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
    <span class="n">googleAuthenticator</span><span class="o">,</span> <span class="n">props</span><span class="o">)</span><span class="err">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">LOGGER</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Google custom authenticator bundle is activated&quot;</span><span class="o">)</span><span class="err">;</span>
   <span class="o">}</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">LOGGER</span><span class="o">.</span><span class="na">fatal</span><span class="o">(</span><span class="s">&quot; Error while activating Google authenticator &quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
 <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="o">(</span><span class="n">ComponentContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">LOGGER</span><span class="o">.</span><span class="na">isDebugEnabled</span><span class="o">())</span> <span class="o">{</span>
   <span class="n">LOGGER</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;Google custom authenticator bundle is deactivated&quot;</span><span class="o">)</span><span class="err">;</span>
  <span class="o">}</span>
 <span class="o">}</span>
<span class="o">}</span> 
 
<span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf­8&quot;</span> <span class="o">?&gt;</span>
<span class="o">&lt;!</span><span class="err">­­</span>
<span class="o">~</span> <span class="n">Copyright</span> <span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="mi">2015</span><span class="o">,</span> <span class="n">WSO2</span> <span class="n">Inc</span><span class="o">.</span> <span class="o">(</span><span class="n">http</span><span class="o">:</span><span class="c1">//www.wso2.org) All Rights Reserved.</span>
<span class="o">~</span>
<span class="o">~</span> <span class="n">Licensed</span> <span class="n">under</span> <span class="n">the</span> <span class="n">Apache</span> <span class="n">License</span><span class="o">,</span> <span class="n">Version</span> <span class="mf">2.0</span> <span class="o">(</span><span class="n">the</span> <span class="s">&quot;License&quot;</span><span class="o">)</span><span class="err">;</span>
<span class="o">~</span> <span class="n">you</span> <span class="n">may</span> <span class="n">not</span> <span class="n">use</span> <span class="k">this</span> <span class="n">file</span> <span class="n">except</span> <span class="n">in</span> <span class="n">compliance</span> <span class="n">with</span> <span class="n">the</span> <span class="n">License</span><span class="o">.</span>
<span class="o">~</span> <span class="n">You</span> <span class="n">may</span> <span class="n">obtain</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">the</span> <span class="n">License</span> <span class="n">at</span>
<span class="o">~</span>
<span class="o">~</span> <span class="n">http</span><span class="o">:</span><span class="c1">//www.apache.org/licenses/LICENSE­2.0</span>
<span class="o">~</span>
<span class="o">~</span> <span class="n">Unless</span> <span class="n">required</span> <span class="n">by</span> <span class="n">applicable</span> <span class="n">law</span> <span class="n">or</span> <span class="n">agreed</span> <span class="n">to</span> <span class="n">in</span> <span class="n">writing</span><span class="o">,</span> <span class="n">software</span>
<span class="o">~</span> <span class="n">distributed</span> <span class="n">under</span> <span class="n">the</span> <span class="n">License</span> <span class="n">is</span> <span class="n">distributed</span> <span class="n">on</span> <span class="n">an</span> <span class="s">&quot;AS IS&quot;</span> <span class="n">BASIS</span><span class="o">,</span>
<span class="o">~</span> <span class="n">WITHOUT</span> <span class="n">WARRANTIES</span> <span class="n">OR</span> <span class="n">CONDITIONS</span> <span class="n">OF</span> <span class="n">ANY</span> <span class="n">KIND</span><span class="o">,</span> <span class="n">either</span> <span class="n">express</span> <span class="n">or</span> <span class="n">implied</span><span class="o">.</span>
<span class="o">~</span> <span class="n">See</span> <span class="n">the</span> <span class="n">License</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specific</span> <span class="n">language</span> <span class="n">governing</span> <span class="n">permissions</span> <span class="n">and</span>
<span class="o">~</span> <span class="n">limitations</span> <span class="n">under</span> <span class="n">the</span> <span class="n">License</span><span class="o">.</span>
<span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">project</span> <span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema­instance&quot;</span> <span class="n">xsi</span><span class="o">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven­v4_0_0.xsd&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">parent</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">application</span><span class="err">­</span><span class="n">authenticators</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">5.0.7</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">parent</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">modelVersion</span><span class="o">&gt;</span><span class="mf">4.0.0</span><span class="o">&lt;/</span><span class="n">modelVersion</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authenticator</span><span class="o">.</span><span class="na">custom</span><span class="o">.</span><span class="na">google</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">packaging</span><span class="o">&gt;</span><span class="n">bundle</span><span class="o">&lt;/</span><span class="n">packaging</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">5.0.0</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">repositories</span><span class="o">&gt;</span>
        <span class="o">&lt;!</span><span class="err">­­</span> <span class="n">Before</span> <span class="n">adding</span> <span class="n">ANYTHING</span> <span class="n">in</span> <span class="n">here</span><span class="o">,</span> <span class="n">please</span> <span class="n">start</span> <span class="n">a</span> <span class="n">discussion</span> <span class="n">on</span> <span class="n">the</span> <span class="n">dev</span> <span class="n">list</span><span class="o">.</span>
<span class="n">Ideally</span> <span class="n">the</span> <span class="n">Axis2</span> <span class="n">build</span> <span class="n">should</span> <span class="n">only</span> <span class="n">use</span> <span class="n">Maven</span> <span class="nf">central</span> <span class="o">(</span><span class="n">which</span> <span class="n">is</span> <span class="n">available</span>
<span class="n">by</span> <span class="k">default</span><span class="o">)</span> <span class="n">and</span> <span class="n">nothing</span> <span class="k">else</span><span class="o">.</span> <span class="n">We</span> <span class="n">had</span> <span class="n">troubles</span> <span class="n">with</span> <span class="n">other</span> <span class="n">repositories</span> <span class="n">in</span>
<span class="n">the</span> <span class="n">past</span><span class="o">.</span> <span class="n">Therefore</span> <span class="n">configuring</span> <span class="n">additional</span> <span class="n">repositories</span> <span class="n">here</span> <span class="n">should</span> <span class="n">be</span>
<span class="n">considered</span> <span class="n">very</span> <span class="n">carefully</span><span class="o">.</span> <span class="err">­­</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">repository</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span><span class="n">wso2</span><span class="err">­</span><span class="n">nexus</span><span class="o">&lt;/</span><span class="n">id</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">WSO2</span> <span class="n">internal</span> <span class="n">Repository</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//maven.wso2.org/nexus/content/groups/wso2­public/&lt;/url&gt;</span>
            <span class="o">&lt;</span><span class="n">releases</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">enabled</span><span class="o">&gt;</span><span class="kc">true</span><span class="o">&lt;/</span><span class="n">enabled</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">updatePolicy</span><span class="o">&gt;</span><span class="n">daily</span><span class="o">&lt;/</span><span class="n">updatePolicy</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">checksumPolicy</span><span class="o">&gt;</span><span class="n">ignore</span><span class="o">&lt;/</span><span class="n">checksumPolicy</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">releases</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">repository</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">repository</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span><span class="n">wso2</span><span class="o">.</span><span class="na">releases</span><span class="o">&lt;/</span><span class="n">id</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">WSO2</span> <span class="n">internal</span> <span class="n">Repository</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//maven.wso2.org/nexus/content/repositories/releases/&lt;/url&gt;</span>
            <span class="o">&lt;</span><span class="n">releases</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">enabled</span><span class="o">&gt;</span><span class="kc">true</span><span class="o">&lt;/</span><span class="n">enabled</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">updatePolicy</span><span class="o">&gt;</span><span class="n">daily</span><span class="o">&lt;/</span><span class="n">updatePolicy</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">checksumPolicy</span><span class="o">&gt;</span><span class="n">ignore</span><span class="o">&lt;/</span><span class="n">checksumPolicy</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">releases</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">repository</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">repository</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">id</span><span class="o">&gt;</span><span class="n">wso2</span><span class="o">.</span><span class="na">snapshots</span><span class="o">&lt;/</span><span class="n">id</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">WSO2</span> <span class="n">Snapshot</span> <span class="n">Repository</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span><span class="n">http</span><span class="o">:</span><span class="c1">//maven.wso2.org/nexus/content/repositories/snapshots/&lt;/url&gt;</span>
            <span class="o">&lt;</span><span class="n">snapshots</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">enabled</span><span class="o">&gt;</span><span class="kc">true</span><span class="o">&lt;/</span><span class="n">enabled</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">updatePolicy</span><span class="o">&gt;</span><span class="n">daily</span><span class="o">&lt;/</span><span class="n">updatePolicy</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">snapshots</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">releases</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">enabled</span><span class="o">&gt;</span><span class="kc">false</span><span class="o">&lt;/</span><span class="n">enabled</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">releases</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">repository</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">repositories</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">dependencies</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">logging</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authentication</span><span class="o">.</span><span class="na">framework</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">ui</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">orbit</span><span class="o">.</span><span class="na">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">oltu</span><span class="o">.</span><span class="na">oauth2</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">oltu</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">common</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authenticator</span><span class="o">.</span><span class="na">openid</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authenticator</span><span class="o">.</span><span class="na">oidc</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">dependencies</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">build</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">plugins</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">plugin</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">felix</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">maven</span><span class="err">­</span><span class="n">scr</span><span class="err">­</span><span class="n">plugin</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">plugin</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">plugin</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">felix</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">maven</span><span class="err">­</span><span class="n">bundle</span><span class="err">­</span><span class="n">plugin</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">extensions</span><span class="o">&gt;</span><span class="kc">true</span><span class="o">&lt;/</span><span class="n">extensions</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">configuration</span><span class="o">&gt;</span>
                    <span class="o">&lt;</span><span class="n">instructions</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">Bundle</span><span class="err">­</span><span class="n">SymbolicName</span><span class="o">&gt;</span><span class="n">$</span><span class="o">{</span><span class="n">project</span><span class="o">.</span><span class="na">artifactId</span><span class="o">}&lt;/</span><span class="n">Bundle</span><span class="err">­</span><span class="n">SymbolicName</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">Bundle</span><span class="err">­</span><span class="n">Name</span><span class="o">&gt;</span><span class="n">$</span><span class="o">{</span><span class="n">project</span><span class="o">.</span><span class="na">artifactId</span><span class="o">}&lt;/</span><span class="n">Bundle</span><span class="err">­</span><span class="n">Name</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">Private</span><span class="err">­</span><span class="n">Package</span><span class="o">&gt;</span>
                            <span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authenticator</span><span class="o">.</span><span class="na">custom</span><span class="o">.</span><span class="na">internal</span>
                        <span class="o">&lt;/</span><span class="n">Private</span><span class="err">­</span><span class="n">Package</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">Import</span><span class="err">­</span><span class="n">Package</span><span class="o">&gt;</span>
                            <span class="n">javax</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">http</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${imp.pkg.version.javax.servlet}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">oltu</span><span class="o">.</span><span class="na">oauth2</span><span class="o">.*</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${oltu.package.import.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">lang</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${commons­lang.wso2.osgi.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">logging</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${commons­logging.osgi.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">commons</span><span class="o">.</span><span class="na">codec</span><span class="o">.</span><span class="na">binary</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${commons­codec.wso2.osgi.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">framework</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${osgi.framework.imp.pkg.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">service</span><span class="o">.</span><span class="na">component</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${osgi.service.component.imp.pkg.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authentication</span><span class="o">.</span><span class="na">framework</span><span class="o">.*</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${carbon.identity.package.import.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">common</span><span class="o">.</span><span class="na">model</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${carbon.identity.package.import.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">util</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${carbon.identity.package.import.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">ui</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;${carbon.kernel.package.import.version.range}&quot;</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authenticator</span><span class="o">.</span><span class="na">oidc</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;[5.0.7, 5.1.0)&quot;</span>
                        <span class="o">&lt;/</span><span class="n">Import</span><span class="err">­</span><span class="n">Package</span><span class="o">&gt;</span>
                        <span class="o">&lt;</span><span class="n">Export</span><span class="err">­</span><span class="n">Package</span><span class="o">&gt;</span>
                            <span class="o">!</span><span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authenticator</span><span class="o">.</span><span class="na">custom</span><span class="o">.</span><span class="na">internal</span><span class="o">,</span> <span class="n">org</span><span class="o">.</span><span class="na">wso2</span><span class="o">.</span><span class="na">carbon</span><span class="o">.</span><span class="na">identity</span><span class="o">.</span><span class="na">application</span><span class="o">.</span><span class="na">authenticator</span><span class="o">.</span><span class="na">custom</span><span class="o">.</span><span class="na">google</span><span class="o">.*</span><span class="err">;</span> <span class="n">version</span><span class="o">=</span><span class="s">&quot;5.0.0&quot;</span>
                        <span class="o">&lt;/</span><span class="n">Export</span><span class="err">­</span><span class="n">Package</span><span class="o">&gt;</span>
                    <span class="o">&lt;/</span><span class="n">instructions</span><span class="o">&gt;</span>
                <span class="o">&lt;/</span><span class="n">configuration</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">plugin</span><span class="o">&gt;</span>
        <span class="o">&lt;/</span><span class="n">plugins</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">build</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">project</span><span class="o">&gt;</span>
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../provision/Extensible_SCIM_User_Schemas_With_WSO2_Identity_Server/" title="Extensible SCIM User Schemas With WSO2 Identity Server" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Extensible SCIM User Schemas With WSO2 Identity Server
              </span>
            </div>
          </a>
        
        
          <a href="../Writing_a_Custom_Local_Authenticator/" title="Writing a Custom Local Authenticator" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Writing a Custom Local Authenticator
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.b41f3d20.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>